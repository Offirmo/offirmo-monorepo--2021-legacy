!function(e,r){for(var t in r)e[t]=r[t]}(exports,function(e){var r={};function t(o){if(r[o])return r[o].exports;var n=r[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,t),n.l=!0,n.exports}return t.m=e,t.c=r,t.d=function(e,r,o){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:o})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(t.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var n in e)t.d(o,n,function(r){return e[r]}.bind(null,n));return o},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},t.p="",t(t.s=11)}([function(e,r){e.exports=require("tslib")},function(e,r){e.exports=require("typescript-string-enums")},,function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const o=t(23);r.create_error=function(e,r={}){const t=new Error(e);return Object.keys(r).forEach(e=>{o.COMMON_ERROR_FIELDS.has(e)&&"name"!==e&&"message"!==e&&"stack"!==e?t[e]=r[e]:(t.details=t.details||{},t.details[e]=r[e])}),t}},,,,function(e,r,t){"use strict";t.r(r);var o=t(1);const n=Object(o.Enum)("play","equip_item","sell_item","rename_avatar","change_avatar_class","redeem_code","start_game","on_start_session","on_logged_in_refresh","acknowledge_engagement_msg_seen","update_to_now","hack");function s(){return o.Enum.keys(n)}const a=Object(o.Enum)("savegame","savegame-bkp","savegame-bkp-m1","savegame-bkp-m2","cloud.pending-actions"),u=Object(o.Enum)("echo","sync");t.d(r,"ActionType",(function(){return n})),t.d(r,"get_action_types",(function(){return s})),t.d(r,"StorageKey",(function(){return a})),t.d(r,"Method",(function(){return u}))},,,,function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const o=t(1),n=t(12),s=t(3),a=t(7),u=t(13);r.handler=async(e,r)=>{if(console.log("\n******* handling a tbrpg-rpcâ€¦ *******"),!r.clientContext)throw new Error("No/bad/outdated token [1]!");if(!r.clientContext.user)throw new Error("No/bad/outdated token [2]!");let t=500,c={jsonrpc:"2.0",id:"???",error:n.get_default_JsonRpc_payload(),result:void 0};try{c.error.code=n.JSONRPC_CODE.invalid_request,t=400,function(e){const{httpMethod:r,body:t,isBase64Encoded:o}=e;if("PUT"!==r)throw s.create_error("Wrong HTTP method!",{statusCode:405});if(o)throw s.create_error("Base 64 unexpected!",{statusCode:422});if(!t||t.length>3e4)throw s.create_error("Bad body!",{statusCode:413})}(e);const r=function(e,r){let t;try{t=JSON.parse(r.body)}catch(r){throw console.error(r),e.error.code=n.JSONRPC_CODE.parse_error,s.create_error("JSON.Parse error!",{statusCode:400})}if(Array.isArray(t))throw e.error.code=n.JSONRPC_CODE.parse_error,s.create_error("Batch RPC not implemented!",{statusCode:501});if("id,jsonrpc,method,params"!==Object.keys(t).sort().join(",")||"2.0"!==t.jsonrpc||!Number.isInteger(t.id)&&"string"!=typeof t.id)throw e.error.code=n.JSONRPC_CODE.invalid_request,s.create_error("Bad JSON-RPC structure!",{statusCode:400});if(e.id=t.id,e.error.data.method=t.method,Object.keys(t.params).length<1)throw e.error.code=n.JSONRPC_CODE.invalid_params,s.create_error("Invalid params!",{statusCode:400});if(!o.Enum.isType(a.Method,t.method))throw e.error.code=n.JSONRPC_CODE.method_not_found,s.create_error("Invalid RPC method!",{statusCode:400});return t}(c,e);if(c.error.code=n.JSONRPC_CODE.internal_error,c.error.message="Unknown internal error while processing the request!",t=500,(c=u.process_rpc(r,c)).error&&c.result)throw new Error("Internal error: unclear result after handling!");c.result&&(t=200)}catch(e){t=e.statusCode||t,c.error=e.jsonrpc_response?e.jsonrpc_response:c.error?c.error:n.get_default_JsonRpc_payload(),c.error.message=e.message,delete c.result}return{statusCode:t,body:JSON.stringify(c)}}},function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const o={parse_error:-32700,invalid_request:-32600,method_not_found:-32601,invalid_params:-32602,internal_error:-32603};r.JSONRPC_CODE=o,r.get_default_JsonRpc_payload=function(){return{code:o.internal_error,message:"Internal error!",data:{}}}},function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const o=t(0),n=t(3),s=t(7),a=o.__importDefault(t(14)),u=o.__importDefault(t(15));r.process_rpc=function(e,r){const{method:t}=e;switch(t){case s.Method.echo:return a.default(e,r);case s.Method.sync:return u.default(e,r);default:throw n.create_error("RPC method not implemented!",{method:t,statusCode:501})}}},function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e,r){const{method:t,params:o}=e;return r.result={method:t,params:o},delete r.error,r}},function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e,r){return r.error.message="not implemented!",r}},,,,,,,,function(e,r,t){"use strict";function o(){return new Set(["name","message","stack","code","statusCode","shouldRedirect","framesToPop","details","SEC","_temp"])}t.r(r);const n=o();t.d(r,"COMMON_ERROR_FIELDS",(function(){return n})),t.d(r,"create",(function(){return o}))}]));