{"version":3,"sources":["../../../node_modules/tiny-invariant/dist/tiny-invariant.esm.js","browser-polyfill.js","../src/generated/index.ts","../node_modules/@offirmo/deferred/src/index.ts","../node_modules/emittery/index.js","../src/index.ts","../node_modules/@offirmo-private/timestamps/src/generate.ts","../node_modules/@offirmo-private/timestamps/src/index.ts","common/consts/entry.ts","common/consts/content--start.ts","common/consts/index.ts","common/utils/stringified-json.ts","common/state/origin.ts","common/state/tab.ts","background/utils.ts","background/state.ts","background/flux.ts","../node_modules/memoize-one/dist/memoize-one.esm.js","common/messages/report-usage.ts","common/messages/index.ts","../node_modules/@offirmo/universal-debug-api-browser/src/consts.ts","../node_modules/@offirmo/universal-debug-api-browser/src/v1/keys.ts","background/react.ts","background/background.ts"],"names":["isProduction","prefix","invariant","condition","message","Error","browser","Object","getPrototypeOf","prototype","CHROME_SEND_MESSAGE_CALLBACK_NO_RESPONSE_MESSAGE","SEND_RESPONSE_DEPRECATION_WARNING","wrapAPIs","extensionAPIs","apiMetadata","keys","length","DefaultWeakMap","WeakMap","constructor","createItem","items","undefined","get","key","has","set","isThenable","value","then","makeCallback","promise","metadata","callbackArgs","runtime","lastError","reject","singleCallbackArg","resolve","pluralizeArguments","numArgs","wrapAsyncFunction","name","asyncFunctionWrapper","target","args","minArgs","maxArgs","Promise","fallbackToNoCallback","cbError","console","warn","noCallback","wrapMethod","method","wrapper","Proxy","apply","targetMethod","thisObj","call","hasOwnProperty","Function","bind","wrapObject","wrappers","cache","create","handlers","proxyTarget","prop","receiver","defineProperty","configurable","enumerable","desc","Reflect","deleteProperty","wrapEvent","wrapperMap","addListener","listener","hasListener","removeListener","loggedSendResponseDeprecationWarning","onMessageWrappers","onMessage","sender","sendResponse","didCallSendResponse","wrappedSendResponse","sendResponsePromise","response","stack","result","err","isResultThenable","sendPromisedResult","msg","error","__mozWebExtensionPolyfillReject__","catch","wrappedSendMessageCallback","reply","wrappedSendMessage","apiNamespaceObj","wrappedCb","push","sendMessage","staticWrappers","onMessageExternal","tabs","settingMetadata","clear","privacy","network","networkPredictionEnabled","webRTCIPHandlingPolicy","services","passwordSavingEnabled","websites","hyperlinkAuditingEnabled","referrersEnabled","chrome","id","module","exports","anyMap","eventsMap","producersMap","anyProducer","Symbol","resolvedPromise","assertEventName","eventName","TypeError","assertListener","getListeners","instance","events","Set","getEventProducers","producers","enqueueProducers","eventData","producer","enqueue","item","all","iterator","isFinished","flush","queue","finish","add","next","done","shift","return","delete","arguments","asyncIterator","defaultMethodNamesOrAssert","methodNames","allEmitteryMethods","Array","isArray","methodName","includes","Emittery","mixin","emitteryPropertyName","getEmitteryProperty","emitteryMethodCaller","Map","on","off","once","data","emit","listeners","anyListeners","staticListeners","staticAnyListeners","map","emitSerial","onAny","offAny","anyEvent","clearListeners","values","listenerCount","size","count","bindMethods","getOwnPropertyNames","filter","v","Typed","areInputsEqual","newInputs","lastInputs","i","memoizeOne","resultFn","isEqual","lastThis","lastArgs","lastResult","calledOnce","memoized","newArgs","_i"],"mappings":"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","file":"background.js","sourceRoot":"../src","sourcesContent":["var isProduction = process.env.NODE_ENV === 'production';\nvar prefix = 'Invariant failed';\nfunction invariant(condition, message) {\n  if (condition) {\n    return;\n  }\n\n  if (isProduction) {\n    throw new Error(prefix);\n  } else {\n    throw new Error(prefix + \": \" + (message || ''));\n  }\n}\n\nexport default invariant;\n","/* webextension-polyfill - v0.5.0 - Thu Sep 26 2019 22:22:26 */\n/* -*- Mode: indent-tabs-mode: nil; js-indent-level: 2 -*- */\n/* vim: set sts=2 sw=2 et tw=80: */\n/* This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\n\"use strict\";\n\nif (typeof browser === \"undefined\" || Object.getPrototypeOf(browser) !== Object.prototype) {\n  const CHROME_SEND_MESSAGE_CALLBACK_NO_RESPONSE_MESSAGE = \"The message port closed before a response was received.\";\n  const SEND_RESPONSE_DEPRECATION_WARNING = \"Returning a Promise is the preferred way to send a reply from an onMessage/onMessageExternal listener, as the sendResponse will be removed from the specs (See https://developer.mozilla.org/docs/Mozilla/Add-ons/WebExtensions/API/runtime/onMessage)\";\n\n  // Wrapping the bulk of this polyfill in a one-time-use function is a minor\n  // optimization for Firefox. Since Spidermonkey does not fully parse the\n  // contents of a function until the first time it's called, and since it will\n  // never actually need to be called, this allows the polyfill to be included\n  // in Firefox nearly for free.\n  const wrapAPIs = extensionAPIs => {\n    // NOTE: apiMetadata is associated to the content of the api-metadata.json file\n    // at build time by replacing the following \"include\" with the content of the\n    // JSON file.\n    const apiMetadata = {\n      \"alarms\": {\n        \"clear\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 1\n        },\n        \"clearAll\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 0\n        },\n        \"get\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 1\n        },\n        \"getAll\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 0\n        }\n      },\n      \"bookmarks\": {\n        \"create\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"get\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"getChildren\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"getRecent\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"getSubTree\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"getTree\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 0\n        },\n        \"move\": {\n          \"minArgs\": 2,\n          \"maxArgs\": 2\n        },\n        \"remove\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"removeTree\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"search\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"update\": {\n          \"minArgs\": 2,\n          \"maxArgs\": 2\n        }\n      },\n      \"browserAction\": {\n        \"disable\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 1,\n          \"fallbackToNoCallback\": true\n        },\n        \"enable\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 1,\n          \"fallbackToNoCallback\": true\n        },\n        \"getBadgeBackgroundColor\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"getBadgeText\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"getPopup\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"getTitle\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"openPopup\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 0\n        },\n        \"setBadgeBackgroundColor\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1,\n          \"fallbackToNoCallback\": true\n        },\n        \"setBadgeText\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1,\n          \"fallbackToNoCallback\": true\n        },\n        \"setIcon\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"setPopup\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1,\n          \"fallbackToNoCallback\": true\n        },\n        \"setTitle\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1,\n          \"fallbackToNoCallback\": true\n        }\n      },\n      \"browsingData\": {\n        \"remove\": {\n          \"minArgs\": 2,\n          \"maxArgs\": 2\n        },\n        \"removeCache\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"removeCookies\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"removeDownloads\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"removeFormData\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"removeHistory\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"removeLocalStorage\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"removePasswords\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"removePluginData\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"settings\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 0\n        }\n      },\n      \"commands\": {\n        \"getAll\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 0\n        }\n      },\n      \"contextMenus\": {\n        \"remove\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"removeAll\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 0\n        },\n        \"update\": {\n          \"minArgs\": 2,\n          \"maxArgs\": 2\n        }\n      },\n      \"cookies\": {\n        \"get\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"getAll\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"getAllCookieStores\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 0\n        },\n        \"remove\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"set\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        }\n      },\n      \"devtools\": {\n        \"inspectedWindow\": {\n          \"eval\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 2,\n            \"singleCallbackArg\": false\n          }\n        },\n        \"panels\": {\n          \"create\": {\n            \"minArgs\": 3,\n            \"maxArgs\": 3,\n            \"singleCallbackArg\": true\n          }\n        }\n      },\n      \"downloads\": {\n        \"cancel\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"download\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"erase\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"getFileIcon\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 2\n        },\n        \"open\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1,\n          \"fallbackToNoCallback\": true\n        },\n        \"pause\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"removeFile\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"resume\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"search\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"show\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1,\n          \"fallbackToNoCallback\": true\n        }\n      },\n      \"extension\": {\n        \"isAllowedFileSchemeAccess\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 0\n        },\n        \"isAllowedIncognitoAccess\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 0\n        }\n      },\n      \"history\": {\n        \"addUrl\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"deleteAll\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 0\n        },\n        \"deleteRange\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"deleteUrl\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"getVisits\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"search\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        }\n      },\n      \"i18n\": {\n        \"detectLanguage\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"getAcceptLanguages\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 0\n        }\n      },\n      \"identity\": {\n        \"launchWebAuthFlow\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        }\n      },\n      \"idle\": {\n        \"queryState\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        }\n      },\n      \"management\": {\n        \"get\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"getAll\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 0\n        },\n        \"getSelf\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 0\n        },\n        \"setEnabled\": {\n          \"minArgs\": 2,\n          \"maxArgs\": 2\n        },\n        \"uninstallSelf\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 1\n        }\n      },\n      \"notifications\": {\n        \"clear\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"create\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 2\n        },\n        \"getAll\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 0\n        },\n        \"getPermissionLevel\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 0\n        },\n        \"update\": {\n          \"minArgs\": 2,\n          \"maxArgs\": 2\n        }\n      },\n      \"pageAction\": {\n        \"getPopup\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"getTitle\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"hide\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1,\n          \"fallbackToNoCallback\": true\n        },\n        \"setIcon\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"setPopup\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1,\n          \"fallbackToNoCallback\": true\n        },\n        \"setTitle\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1,\n          \"fallbackToNoCallback\": true\n        },\n        \"show\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1,\n          \"fallbackToNoCallback\": true\n        }\n      },\n      \"permissions\": {\n        \"contains\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"getAll\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 0\n        },\n        \"remove\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"request\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        }\n      },\n      \"runtime\": {\n        \"getBackgroundPage\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 0\n        },\n        \"getPlatformInfo\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 0\n        },\n        \"openOptionsPage\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 0\n        },\n        \"requestUpdateCheck\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 0\n        },\n        \"sendMessage\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 3\n        },\n        \"sendNativeMessage\": {\n          \"minArgs\": 2,\n          \"maxArgs\": 2\n        },\n        \"setUninstallURL\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        }\n      },\n      \"sessions\": {\n        \"getDevices\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 1\n        },\n        \"getRecentlyClosed\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 1\n        },\n        \"restore\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 1\n        }\n      },\n      \"storage\": {\n        \"local\": {\n          \"clear\": {\n            \"minArgs\": 0,\n            \"maxArgs\": 0\n          },\n          \"get\": {\n            \"minArgs\": 0,\n            \"maxArgs\": 1\n          },\n          \"getBytesInUse\": {\n            \"minArgs\": 0,\n            \"maxArgs\": 1\n          },\n          \"remove\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1\n          },\n          \"set\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1\n          }\n        },\n        \"managed\": {\n          \"get\": {\n            \"minArgs\": 0,\n            \"maxArgs\": 1\n          },\n          \"getBytesInUse\": {\n            \"minArgs\": 0,\n            \"maxArgs\": 1\n          }\n        },\n        \"sync\": {\n          \"clear\": {\n            \"minArgs\": 0,\n            \"maxArgs\": 0\n          },\n          \"get\": {\n            \"minArgs\": 0,\n            \"maxArgs\": 1\n          },\n          \"getBytesInUse\": {\n            \"minArgs\": 0,\n            \"maxArgs\": 1\n          },\n          \"remove\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1\n          },\n          \"set\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1\n          }\n        }\n      },\n      \"tabs\": {\n        \"captureVisibleTab\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 2\n        },\n        \"create\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"detectLanguage\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 1\n        },\n        \"discard\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 1\n        },\n        \"duplicate\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"executeScript\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 2\n        },\n        \"get\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"getCurrent\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 0\n        },\n        \"getZoom\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 1\n        },\n        \"getZoomSettings\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 1\n        },\n        \"highlight\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"insertCSS\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 2\n        },\n        \"move\": {\n          \"minArgs\": 2,\n          \"maxArgs\": 2\n        },\n        \"query\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"reload\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 2\n        },\n        \"remove\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"removeCSS\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 2\n        },\n        \"sendMessage\": {\n          \"minArgs\": 2,\n          \"maxArgs\": 3\n        },\n        \"setZoom\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 2\n        },\n        \"setZoomSettings\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 2\n        },\n        \"update\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 2\n        }\n      },\n      \"topSites\": {\n        \"get\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 0\n        }\n      },\n      \"webNavigation\": {\n        \"getAllFrames\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"getFrame\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        }\n      },\n      \"webRequest\": {\n        \"handlerBehaviorChanged\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 0\n        }\n      },\n      \"windows\": {\n        \"create\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 1\n        },\n        \"get\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 2\n        },\n        \"getAll\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 1\n        },\n        \"getCurrent\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 1\n        },\n        \"getLastFocused\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 1\n        },\n        \"remove\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"update\": {\n          \"minArgs\": 2,\n          \"maxArgs\": 2\n        }\n      }\n    };\n\n    if (Object.keys(apiMetadata).length === 0) {\n      throw new Error(\"api-metadata.json has not been included in browser-polyfill\");\n    }\n\n    /**\n     * A WeakMap subclass which creates and stores a value for any key which does\n     * not exist when accessed, but behaves exactly as an ordinary WeakMap\n     * otherwise.\n     *\n     * @param {function} createItem\n     *        A function which will be called in order to create the value for any\n     *        key which does not exist, the first time it is accessed. The\n     *        function receives, as its only argument, the key being created.\n     */\n    class DefaultWeakMap extends WeakMap {\n      constructor(createItem, items = undefined) {\n        super(items);\n        this.createItem = createItem;\n      }\n\n      get(key) {\n        if (!this.has(key)) {\n          this.set(key, this.createItem(key));\n        }\n\n        return super.get(key);\n      }\n    }\n\n    /**\n     * Returns true if the given object is an object with a `then` method, and can\n     * therefore be assumed to behave as a Promise.\n     *\n     * @param {*} value The value to test.\n     * @returns {boolean} True if the value is thenable.\n     */\n    const isThenable = value => {\n      return value && typeof value === \"object\" && typeof value.then === \"function\";\n    };\n\n    /**\n     * Creates and returns a function which, when called, will resolve or reject\n     * the given promise based on how it is called:\n     *\n     * - If, when called, `chrome.runtime.lastError` contains a non-null object,\n     *   the promise is rejected with that value.\n     * - If the function is called with exactly one argument, the promise is\n     *   resolved to that value.\n     * - Otherwise, the promise is resolved to an array containing all of the\n     *   function's arguments.\n     *\n     * @param {object} promise\n     *        An object containing the resolution and rejection functions of a\n     *        promise.\n     * @param {function} promise.resolve\n     *        The promise's resolution function.\n     * @param {function} promise.rejection\n     *        The promise's rejection function.\n     * @param {object} metadata\n     *        Metadata about the wrapped method which has created the callback.\n     * @param {integer} metadata.maxResolvedArgs\n     *        The maximum number of arguments which may be passed to the\n     *        callback created by the wrapped async function.\n     *\n     * @returns {function}\n     *        The generated callback function.\n     */\n    const makeCallback = (promise, metadata) => {\n      return (...callbackArgs) => {\n        if (extensionAPIs.runtime.lastError) {\n          promise.reject(extensionAPIs.runtime.lastError);\n        } else if (metadata.singleCallbackArg ||\n                   (callbackArgs.length <= 1 && metadata.singleCallbackArg !== false)) {\n          promise.resolve(callbackArgs[0]);\n        } else {\n          promise.resolve(callbackArgs);\n        }\n      };\n    };\n\n    const pluralizeArguments = (numArgs) => numArgs == 1 ? \"argument\" : \"arguments\";\n\n    /**\n     * Creates a wrapper function for a method with the given name and metadata.\n     *\n     * @param {string} name\n     *        The name of the method which is being wrapped.\n     * @param {object} metadata\n     *        Metadata about the method being wrapped.\n     * @param {integer} metadata.minArgs\n     *        The minimum number of arguments which must be passed to the\n     *        function. If called with fewer than this number of arguments, the\n     *        wrapper will raise an exception.\n     * @param {integer} metadata.maxArgs\n     *        The maximum number of arguments which may be passed to the\n     *        function. If called with more than this number of arguments, the\n     *        wrapper will raise an exception.\n     * @param {integer} metadata.maxResolvedArgs\n     *        The maximum number of arguments which may be passed to the\n     *        callback created by the wrapped async function.\n     *\n     * @returns {function(object, ...*)}\n     *       The generated wrapper function.\n     */\n    const wrapAsyncFunction = (name, metadata) => {\n      return function asyncFunctionWrapper(target, ...args) {\n        if (args.length < metadata.minArgs) {\n          throw new Error(`Expected at least ${metadata.minArgs} ${pluralizeArguments(metadata.minArgs)} for ${name}(), got ${args.length}`);\n        }\n\n        if (args.length > metadata.maxArgs) {\n          throw new Error(`Expected at most ${metadata.maxArgs} ${pluralizeArguments(metadata.maxArgs)} for ${name}(), got ${args.length}`);\n        }\n\n        return new Promise((resolve, reject) => {\n          if (metadata.fallbackToNoCallback) {\n            // This API method has currently no callback on Chrome, but it return a promise on Firefox,\n            // and so the polyfill will try to call it with a callback first, and it will fallback\n            // to not passing the callback if the first call fails.\n            try {\n              target[name](...args, makeCallback({resolve, reject}, metadata));\n            } catch (cbError) {\n              console.warn(`${name} API method doesn't seem to support the callback parameter, ` +\n                           \"falling back to call it without a callback: \", cbError);\n\n              target[name](...args);\n\n              // Update the API method metadata, so that the next API calls will not try to\n              // use the unsupported callback anymore.\n              metadata.fallbackToNoCallback = false;\n              metadata.noCallback = true;\n\n              resolve();\n            }\n          } else if (metadata.noCallback) {\n            target[name](...args);\n            resolve();\n          } else {\n            target[name](...args, makeCallback({resolve, reject}, metadata));\n          }\n        });\n      };\n    };\n\n    /**\n     * Wraps an existing method of the target object, so that calls to it are\n     * intercepted by the given wrapper function. The wrapper function receives,\n     * as its first argument, the original `target` object, followed by each of\n     * the arguments passed to the original method.\n     *\n     * @param {object} target\n     *        The original target object that the wrapped method belongs to.\n     * @param {function} method\n     *        The method being wrapped. This is used as the target of the Proxy\n     *        object which is created to wrap the method.\n     * @param {function} wrapper\n     *        The wrapper function which is called in place of a direct invocation\n     *        of the wrapped method.\n     *\n     * @returns {Proxy<function>}\n     *        A Proxy object for the given method, which invokes the given wrapper\n     *        method in its place.\n     */\n    const wrapMethod = (target, method, wrapper) => {\n      return new Proxy(method, {\n        apply(targetMethod, thisObj, args) {\n          return wrapper.call(thisObj, target, ...args);\n        },\n      });\n    };\n\n    let hasOwnProperty = Function.call.bind(Object.prototype.hasOwnProperty);\n\n    /**\n     * Wraps an object in a Proxy which intercepts and wraps certain methods\n     * based on the given `wrappers` and `metadata` objects.\n     *\n     * @param {object} target\n     *        The target object to wrap.\n     *\n     * @param {object} [wrappers = {}]\n     *        An object tree containing wrapper functions for special cases. Any\n     *        function present in this object tree is called in place of the\n     *        method in the same location in the `target` object tree. These\n     *        wrapper methods are invoked as described in {@see wrapMethod}.\n     *\n     * @param {object} [metadata = {}]\n     *        An object tree containing metadata used to automatically generate\n     *        Promise-based wrapper functions for asynchronous. Any function in\n     *        the `target` object tree which has a corresponding metadata object\n     *        in the same location in the `metadata` tree is replaced with an\n     *        automatically-generated wrapper function, as described in\n     *        {@see wrapAsyncFunction}\n     *\n     * @returns {Proxy<object>}\n     */\n    const wrapObject = (target, wrappers = {}, metadata = {}) => {\n      let cache = Object.create(null);\n      let handlers = {\n        has(proxyTarget, prop) {\n          return prop in target || prop in cache;\n        },\n\n        get(proxyTarget, prop, receiver) {\n          if (prop in cache) {\n            return cache[prop];\n          }\n\n          if (!(prop in target)) {\n            return undefined;\n          }\n\n          let value = target[prop];\n\n          if (typeof value === \"function\") {\n            // This is a method on the underlying object. Check if we need to do\n            // any wrapping.\n\n            if (typeof wrappers[prop] === \"function\") {\n              // We have a special-case wrapper for this method.\n              value = wrapMethod(target, target[prop], wrappers[prop]);\n            } else if (hasOwnProperty(metadata, prop)) {\n              // This is an async method that we have metadata for. Create a\n              // Promise wrapper for it.\n              let wrapper = wrapAsyncFunction(prop, metadata[prop]);\n              value = wrapMethod(target, target[prop], wrapper);\n            } else {\n              // This is a method that we don't know or care about. Return the\n              // original method, bound to the underlying object.\n              value = value.bind(target);\n            }\n          } else if (typeof value === \"object\" && value !== null &&\n                     (hasOwnProperty(wrappers, prop) ||\n                      hasOwnProperty(metadata, prop))) {\n            // This is an object that we need to do some wrapping for the children\n            // of. Create a sub-object wrapper for it with the appropriate child\n            // metadata.\n            value = wrapObject(value, wrappers[prop], metadata[prop]);\n          } else {\n            // We don't need to do any wrapping for this property,\n            // so just forward all access to the underlying object.\n            Object.defineProperty(cache, prop, {\n              configurable: true,\n              enumerable: true,\n              get() {\n                return target[prop];\n              },\n              set(value) {\n                target[prop] = value;\n              },\n            });\n\n            return value;\n          }\n\n          cache[prop] = value;\n          return value;\n        },\n\n        set(proxyTarget, prop, value, receiver) {\n          if (prop in cache) {\n            cache[prop] = value;\n          } else {\n            target[prop] = value;\n          }\n          return true;\n        },\n\n        defineProperty(proxyTarget, prop, desc) {\n          return Reflect.defineProperty(cache, prop, desc);\n        },\n\n        deleteProperty(proxyTarget, prop) {\n          return Reflect.deleteProperty(cache, prop);\n        },\n      };\n\n      // Per contract of the Proxy API, the \"get\" proxy handler must return the\n      // original value of the target if that value is declared read-only and\n      // non-configurable. For this reason, we create an object with the\n      // prototype set to `target` instead of using `target` directly.\n      // Otherwise we cannot return a custom object for APIs that\n      // are declared read-only and non-configurable, such as `chrome.devtools`.\n      //\n      // The proxy handlers themselves will still use the original `target`\n      // instead of the `proxyTarget`, so that the methods and properties are\n      // dereferenced via the original targets.\n      let proxyTarget = Object.create(target);\n      return new Proxy(proxyTarget, handlers);\n    };\n\n    /**\n     * Creates a set of wrapper functions for an event object, which handles\n     * wrapping of listener functions that those messages are passed.\n     *\n     * A single wrapper is created for each listener function, and stored in a\n     * map. Subsequent calls to `addListener`, `hasListener`, or `removeListener`\n     * retrieve the original wrapper, so that  attempts to remove a\n     * previously-added listener work as expected.\n     *\n     * @param {DefaultWeakMap<function, function>} wrapperMap\n     *        A DefaultWeakMap object which will create the appropriate wrapper\n     *        for a given listener function when one does not exist, and retrieve\n     *        an existing one when it does.\n     *\n     * @returns {object}\n     */\n    const wrapEvent = wrapperMap => ({\n      addListener(target, listener, ...args) {\n        target.addListener(wrapperMap.get(listener), ...args);\n      },\n\n      hasListener(target, listener) {\n        return target.hasListener(wrapperMap.get(listener));\n      },\n\n      removeListener(target, listener) {\n        target.removeListener(wrapperMap.get(listener));\n      },\n    });\n\n    // Keep track if the deprecation warning has been logged at least once.\n    let loggedSendResponseDeprecationWarning = false;\n\n    const onMessageWrappers = new DefaultWeakMap(listener => {\n      if (typeof listener !== \"function\") {\n        return listener;\n      }\n\n      /**\n       * Wraps a message listener function so that it may send responses based on\n       * its return value, rather than by returning a sentinel value and calling a\n       * callback. If the listener function returns a Promise, the response is\n       * sent when the promise either resolves or rejects.\n       *\n       * @param {*} message\n       *        The message sent by the other end of the channel.\n       * @param {object} sender\n       *        Details about the sender of the message.\n       * @param {function(*)} sendResponse\n       *        A callback which, when called with an arbitrary argument, sends\n       *        that value as a response.\n       * @returns {boolean}\n       *        True if the wrapped listener returned a Promise, which will later\n       *        yield a response. False otherwise.\n       */\n      return function onMessage(message, sender, sendResponse) {\n        let didCallSendResponse = false;\n\n        let wrappedSendResponse;\n        let sendResponsePromise = new Promise(resolve => {\n          wrappedSendResponse = function(response) {\n            if (!loggedSendResponseDeprecationWarning) {\n              console.warn(SEND_RESPONSE_DEPRECATION_WARNING, new Error().stack);\n              loggedSendResponseDeprecationWarning = true;\n            }\n            didCallSendResponse = true;\n            resolve(response);\n          };\n        });\n\n        let result;\n        try {\n          result = listener(message, sender, wrappedSendResponse);\n        } catch (err) {\n          result = Promise.reject(err);\n        }\n\n        const isResultThenable = result !== true && isThenable(result);\n\n        // If the listener didn't returned true or a Promise, or called\n        // wrappedSendResponse synchronously, we can exit earlier\n        // because there will be no response sent from this listener.\n        if (result !== true && !isResultThenable && !didCallSendResponse) {\n          return false;\n        }\n\n        // A small helper to send the message if the promise resolves\n        // and an error if the promise rejects (a wrapped sendMessage has\n        // to translate the message into a resolved promise or a rejected\n        // promise).\n        const sendPromisedResult = (promise) => {\n          promise.then(msg => {\n            // send the message value.\n            sendResponse(msg);\n          }, error => {\n            // Send a JSON representation of the error if the rejected value\n            // is an instance of error, or the object itself otherwise.\n            let message;\n            if (error && (error instanceof Error ||\n                typeof error.message === \"string\")) {\n              message = error.message;\n            } else {\n              message = \"An unexpected error occurred\";\n            }\n\n            sendResponse({\n              __mozWebExtensionPolyfillReject__: true,\n              message,\n            });\n          }).catch(err => {\n            // Print an error on the console if unable to send the response.\n            console.error(\"Failed to send onMessage rejected reply\", err);\n          });\n        };\n\n        // If the listener returned a Promise, send the resolved value as a\n        // result, otherwise wait the promise related to the wrappedSendResponse\n        // callback to resolve and send it as a response.\n        if (isResultThenable) {\n          sendPromisedResult(result);\n        } else {\n          sendPromisedResult(sendResponsePromise);\n        }\n\n        // Let Chrome know that the listener is replying.\n        return true;\n      };\n    });\n\n    const wrappedSendMessageCallback = ({reject, resolve}, reply) => {\n      if (extensionAPIs.runtime.lastError) {\n        // Detect when none of the listeners replied to the sendMessage call and resolve\n        // the promise to undefined as in Firefox.\n        // See https://github.com/mozilla/webextension-polyfill/issues/130\n        if (extensionAPIs.runtime.lastError.message === CHROME_SEND_MESSAGE_CALLBACK_NO_RESPONSE_MESSAGE) {\n          resolve();\n        } else {\n          reject(extensionAPIs.runtime.lastError);\n        }\n      } else if (reply && reply.__mozWebExtensionPolyfillReject__) {\n        // Convert back the JSON representation of the error into\n        // an Error instance.\n        reject(new Error(reply.message));\n      } else {\n        resolve(reply);\n      }\n    };\n\n    const wrappedSendMessage = (name, metadata, apiNamespaceObj, ...args) => {\n      if (args.length < metadata.minArgs) {\n        throw new Error(`Expected at least ${metadata.minArgs} ${pluralizeArguments(metadata.minArgs)} for ${name}(), got ${args.length}`);\n      }\n\n      if (args.length > metadata.maxArgs) {\n        throw new Error(`Expected at most ${metadata.maxArgs} ${pluralizeArguments(metadata.maxArgs)} for ${name}(), got ${args.length}`);\n      }\n\n      return new Promise((resolve, reject) => {\n        const wrappedCb = wrappedSendMessageCallback.bind(null, {resolve, reject});\n        args.push(wrappedCb);\n        apiNamespaceObj.sendMessage(...args);\n      });\n    };\n\n    const staticWrappers = {\n      runtime: {\n        onMessage: wrapEvent(onMessageWrappers),\n        onMessageExternal: wrapEvent(onMessageWrappers),\n        sendMessage: wrappedSendMessage.bind(null, \"sendMessage\", {minArgs: 1, maxArgs: 3}),\n      },\n      tabs: {\n        sendMessage: wrappedSendMessage.bind(null, \"sendMessage\", {minArgs: 2, maxArgs: 3}),\n      },\n    };\n    const settingMetadata = {\n      clear: {minArgs: 1, maxArgs: 1},\n      get: {minArgs: 1, maxArgs: 1},\n      set: {minArgs: 1, maxArgs: 1},\n    };\n    apiMetadata.privacy = {\n      network: {\n        networkPredictionEnabled: settingMetadata,\n        webRTCIPHandlingPolicy: settingMetadata,\n      },\n      services: {\n        passwordSavingEnabled: settingMetadata,\n      },\n      websites: {\n        hyperlinkAuditingEnabled: settingMetadata,\n        referrersEnabled: settingMetadata,\n      },\n    };\n\n    return wrapObject(extensionAPIs, staticWrappers, apiMetadata);\n  };\n\n  if (typeof chrome != \"object\" || !chrome || !chrome.runtime || !chrome.runtime.id) {\n    throw new Error(\"This script should only be loaded in a browser extension.\");\n  }\n\n  // The build process adds a UMD wrapper around this file, which makes the\n  // `module` variable available.\n  module.exports = wrapAPIs(chrome);\n} else {\n  module.exports = browser;\n}\n","import { ActivityLog } from \"./activityLog\";\nimport { Alarms } from \"./alarms\";\nimport { Bookmarks } from \"./bookmarks\";\nimport { BrowserAction } from \"./browserAction\";\nimport { BrowserSettings } from \"./browserSettings\";\nimport { BrowsingData } from \"./browsingData\";\nimport { CaptivePortal } from \"./captivePortal\";\nimport { Clipboard } from \"./clipboard\";\nimport { Commands } from \"./commands\";\nimport { ContentScripts } from \"./contentScripts\";\nimport { ContextualIdentities } from \"./contextualIdentities\";\nimport { Cookies } from \"./cookies\";\nimport { Devtools } from \"./devtools\";\nimport { Dns } from \"./dns\";\nimport { Downloads } from \"./downloads\";\nimport { Events } from \"./events\";\nimport { Experiments } from \"./experiments\";\nimport { Extension } from \"./extension\";\nimport { ExtensionTypes } from \"./extensionTypes\";\nimport { Find } from \"./find\";\nimport { GeckoProfiler } from \"./geckoProfiler\";\nimport { History } from \"./history\";\nimport { I18n } from \"./i18n\";\nimport { Identity } from \"./identity\";\nimport { Idle } from \"./idle\";\nimport { Management } from \"./management\";\nimport { Manifest } from \"./manifest\";\nimport { ContextMenus } from \"./contextMenus\";\nimport { Menus } from \"./menus\";\nimport { NetworkStatus } from \"./networkStatus\";\nimport { NormandyAddonStudy } from \"./normandyAddonStudy\";\nimport { Notifications } from \"./notifications\";\nimport { Omnibox } from \"./omnibox\";\nimport { PageAction } from \"./pageAction\";\nimport { Permissions } from \"./permissions\";\nimport { Pkcs11 } from \"./pkcs11\";\nimport { Privacy } from \"./privacy\";\nimport { Proxy } from \"./proxy\";\nimport { Runtime } from \"./runtime\";\nimport { Search } from \"./search\";\nimport { Sessions } from \"./sessions\";\nimport { SidebarAction } from \"./sidebarAction\";\nimport { Storage } from \"./storage\";\nimport { Tabs } from \"./tabs\";\nimport { Theme } from \"./theme\";\nimport { TopSites } from \"./topSites\";\nimport { Types } from \"./types\";\nimport { Urlbar } from \"./urlbar\";\nimport { UserScripts } from \"./userScripts\";\nimport { WebNavigation } from \"./webNavigation\";\nimport { WebRequest } from \"./webRequest\";\nimport { Windows } from \"./windows\";\nexport { ActivityLog } from \"./activityLog\";\nexport { Alarms } from \"./alarms\";\nexport { Bookmarks } from \"./bookmarks\";\nexport { BrowserAction } from \"./browserAction\";\nexport { BrowserSettings } from \"./browserSettings\";\nexport { BrowsingData } from \"./browsingData\";\nexport { CaptivePortal } from \"./captivePortal\";\nexport { Clipboard } from \"./clipboard\";\nexport { Commands } from \"./commands\";\nexport { ContentScripts } from \"./contentScripts\";\nexport { ContextualIdentities } from \"./contextualIdentities\";\nexport { Cookies } from \"./cookies\";\nexport { Devtools } from \"./devtools\";\nexport { DevtoolsInspectedWindow } from \"./devtools_inspectedWindow\";\nexport { DevtoolsNetwork } from \"./devtools_network\";\nexport { DevtoolsPanels } from \"./devtools_panels\";\nexport { Dns } from \"./dns\";\nexport { Downloads } from \"./downloads\";\nexport { Events } from \"./events\";\nexport { Experiments } from \"./experiments\";\nexport { Extension } from \"./extension\";\nexport { ExtensionTypes } from \"./extensionTypes\";\nexport { Find } from \"./find\";\nexport { GeckoProfiler } from \"./geckoProfiler\";\nexport { History } from \"./history\";\nexport { I18n } from \"./i18n\";\nexport { Identity } from \"./identity\";\nexport { Idle } from \"./idle\";\nexport { Management } from \"./management\";\nexport { Manifest } from \"./manifest\";\nexport { ContextMenus } from \"./contextMenus\";\nexport { Menus } from \"./menus\";\nexport { NetworkStatus } from \"./networkStatus\";\nexport { NormandyAddonStudy } from \"./normandyAddonStudy\";\nexport { Notifications } from \"./notifications\";\nexport { Omnibox } from \"./omnibox\";\nexport { PageAction } from \"./pageAction\";\nexport { Permissions } from \"./permissions\";\nexport { Pkcs11 } from \"./pkcs11\";\nexport { Privacy } from \"./privacy\";\nexport { PrivacyNetwork } from \"./privacy_network\";\nexport { PrivacyServices } from \"./privacy_services\";\nexport { PrivacyWebsites } from \"./privacy_websites\";\nexport { Proxy } from \"./proxy\";\nexport { Runtime } from \"./runtime\";\nexport { Search } from \"./search\";\nexport { Sessions } from \"./sessions\";\nexport { SidebarAction } from \"./sidebarAction\";\nexport { Storage } from \"./storage\";\nexport { Tabs } from \"./tabs\";\nexport { Theme } from \"./theme\";\nexport { TopSites } from \"./topSites\";\nexport { Types } from \"./types\";\nexport { Urlbar } from \"./urlbar\";\nexport { UrlbarContextualTip } from \"./urlbar_contextualTip\";\nexport { UserScripts } from \"./userScripts\";\nexport { WebNavigation } from \"./webNavigation\";\nexport { WebRequest } from \"./webRequest\";\nexport { Windows } from \"./windows\";\n\nexport interface Browser {\n    activityLog: ActivityLog.Static;\n    alarms: Alarms.Static;\n    bookmarks: Bookmarks.Static;\n    browserAction: BrowserAction.Static;\n    browserSettings: BrowserSettings.Static;\n    browsingData: BrowsingData.Static;\n    captivePortal: CaptivePortal.Static;\n    clipboard: Clipboard.Static;\n    commands: Commands.Static;\n    contentScripts: ContentScripts.Static;\n    contextualIdentities: ContextualIdentities.Static;\n    cookies: Cookies.Static;\n    devtools: Devtools.Static;\n    dns: Dns.Static;\n    downloads: Downloads.Static;\n    events: Events.Static;\n    experiments: Experiments.Static;\n    extension: Extension.Static;\n    extensionTypes: ExtensionTypes.Static;\n    find: Find.Static;\n    geckoProfiler: GeckoProfiler.Static;\n    history: History.Static;\n    i18n: I18n.Static;\n    identity: Identity.Static;\n    idle: Idle.Static;\n    management: Management.Static;\n    manifest: Manifest.Static;\n    contextMenus: ContextMenus.Static;\n    menus: Menus.Static;\n    networkStatus: NetworkStatus.Static;\n    normandyAddonStudy: NormandyAddonStudy.Static;\n    notifications: Notifications.Static;\n    omnibox: Omnibox.Static;\n    pageAction: PageAction.Static;\n    permissions: Permissions.Static;\n    pkcs11: Pkcs11.Static;\n    privacy: Privacy.Static;\n    proxy: Proxy.Static;\n    runtime: Runtime.Static;\n    search: Search.Static;\n    sessions: Sessions.Static;\n    sidebarAction: SidebarAction.Static;\n    storage: Storage.Static;\n    tabs: Tabs.Static;\n    theme: Theme.Static;\n    topSites: TopSites.Static;\n    types: Types.Static;\n    urlbar: Urlbar.Static;\n    userScripts: UserScripts.Static;\n    webNavigation: WebNavigation.Static;\n    webRequest: WebRequest.Static;\n    windows: Windows.Static;\n}\n\nfunction getBrowser(): Browser {\n    // if not in a browser, assume we're in a test, return a dummy\n    if (typeof window === 'undefined') {\n        //@ts-ignore\n        return {};\n    }\n\n    //@ts-ignore\n    return require('webextension-polyfill');\n}\n\nexport const browser = getBrowser();\n","\n// 1. copied from https://github.com/Microsoft/TypeScript/issues/15202#issuecomment-318900991\n// 2. then improved to match the latest Promise typings\n\nexport default class Deferred<T> {\n\tprivate _resolve!: (value?: T | PromiseLike<T>) => void\n\tprivate _reject!: (reason?: any) => void\n\tprivate readonly promise: Promise<T>\n\n\tconstructor() {\n\t\tthis.promise = new Promise((resolve, reject) => {\n\t\t\tthis._resolve = resolve\n\t\t\tthis._reject = reject\n\t\t})\n\t}\n\n\tthen<TResult1 = T, TResult2 = never>(\n\t\tonfulfilled?: ((value: T) => TResult1 | PromiseLike<TResult1>) | undefined | null,\n\t\tonrejected?: ((reason: any) => TResult2 | PromiseLike<TResult2>) | undefined | null,\n\t): Promise<TResult1 | TResult2> {\n\t\treturn this.promise.then(onfulfilled, onrejected)\n\t}\n\n\tcatch<TResult = never>(onrejected?: ((reason: any) => TResult | PromiseLike<TResult>)): Promise<T | TResult> {\n\t\treturn this.promise.catch(onrejected)\n\t}\n\n\tresolve(value?: T | PromiseLike<T>): void {\n\t\treturn this._resolve(value)\n\t}\n\n\treject(reason?: any): void {\n\t\treturn this._reject(reason)\n\t}\n\n\tfinally(onfinally?: (() => void) | undefined | null): Promise<T> {\n\t\treturn this.promise.finally(onfinally)\n\t}\n\n\t// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol/toStringTag\n\tget [Symbol.toStringTag]() {\n\t\treturn 'Deferred'\n\t}\n}\n","'use strict';\n\nconst anyMap = new WeakMap();\nconst eventsMap = new WeakMap();\nconst producersMap = new WeakMap();\nconst anyProducer = Symbol('anyProducer');\nconst resolvedPromise = Promise.resolve();\n\nfunction assertEventName(eventName) {\n\tif (typeof eventName !== 'string') {\n\t\tthrow new TypeError('eventName must be a string');\n\t}\n}\n\nfunction assertListener(listener) {\n\tif (typeof listener !== 'function') {\n\t\tthrow new TypeError('listener must be a function');\n\t}\n}\n\nfunction getListeners(instance, eventName) {\n\tconst events = eventsMap.get(instance);\n\tif (!events.has(eventName)) {\n\t\tevents.set(eventName, new Set());\n\t}\n\n\treturn events.get(eventName);\n}\n\nfunction getEventProducers(instance, eventName) {\n\tconst key = typeof eventName === 'string' ? eventName : anyProducer;\n\tconst producers = producersMap.get(instance);\n\tif (!producers.has(key)) {\n\t\tproducers.set(key, new Set());\n\t}\n\n\treturn producers.get(key);\n}\n\nfunction enqueueProducers(instance, eventName, eventData) {\n\tconst producers = producersMap.get(instance);\n\tif (producers.has(eventName)) {\n\t\tfor (const producer of producers.get(eventName)) {\n\t\t\tproducer.enqueue(eventData);\n\t\t}\n\t}\n\n\tif (producers.has(anyProducer)) {\n\t\tconst item = Promise.all([eventName, eventData]);\n\t\tfor (const producer of producers.get(anyProducer)) {\n\t\t\tproducer.enqueue(item);\n\t\t}\n\t}\n}\n\nfunction iterator(instance, eventName) {\n\tlet isFinished = false;\n\tlet flush = () => {};\n\tlet queue = [];\n\n\tconst producer = {\n\t\tenqueue(item) {\n\t\t\tqueue.push(item);\n\t\t\tflush();\n\t\t},\n\t\tfinish() {\n\t\t\tisFinished = true;\n\t\t\tflush();\n\t\t}\n\t};\n\n\tgetEventProducers(instance, eventName).add(producer);\n\n\treturn {\n\t\tasync next() {\n\t\t\tif (!queue) {\n\t\t\t\treturn {done: true};\n\t\t\t}\n\n\t\t\tif (queue.length === 0) {\n\t\t\t\tif (isFinished) {\n\t\t\t\t\tqueue = undefined;\n\t\t\t\t\treturn this.next();\n\t\t\t\t}\n\n\t\t\t\tawait new Promise(resolve => {\n\t\t\t\t\tflush = resolve;\n\t\t\t\t});\n\n\t\t\t\treturn this.next();\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tdone: false,\n\t\t\t\tvalue: await queue.shift()\n\t\t\t};\n\t\t},\n\n\t\tasync return(value) {\n\t\t\tqueue = undefined;\n\t\t\tgetEventProducers(instance, eventName).delete(producer);\n\t\t\tflush();\n\n\t\t\treturn arguments.length > 0 ?\n\t\t\t\t{done: true, value: await value} :\n\t\t\t\t{done: true};\n\t\t},\n\n\t\t[Symbol.asyncIterator]() {\n\t\t\treturn this;\n\t\t}\n\t};\n}\n\nfunction defaultMethodNamesOrAssert(methodNames) {\n\tif (methodNames === undefined) {\n\t\treturn allEmitteryMethods;\n\t}\n\n\tif (!Array.isArray(methodNames)) {\n\t\tthrow new TypeError('`methodNames` must be an array of strings');\n\t}\n\n\tfor (const methodName of methodNames) {\n\t\tif (!allEmitteryMethods.includes(methodName)) {\n\t\t\tif (typeof methodName !== 'string') {\n\t\t\t\tthrow new TypeError('`methodNames` element must be a string');\n\t\t\t}\n\n\t\t\tthrow new Error(`${methodName} is not Emittery method`);\n\t\t}\n\t}\n\n\treturn methodNames;\n}\n\nclass Emittery {\n\tstatic mixin(emitteryPropertyName, methodNames) {\n\t\tmethodNames = defaultMethodNamesOrAssert(methodNames);\n\t\treturn target => {\n\t\t\tif (typeof target !== 'function') {\n\t\t\t\tthrow new TypeError('`target` must be function');\n\t\t\t}\n\n\t\t\tfor (const methodName of methodNames) {\n\t\t\t\tif (target.prototype[methodName] !== undefined) {\n\t\t\t\t\tthrow new Error(`The property \\`${methodName}\\` already exists on \\`target\\``);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction getEmitteryProperty() {\n\t\t\t\tObject.defineProperty(this, emitteryPropertyName, {\n\t\t\t\t\tenumerable: false,\n\t\t\t\t\tvalue: new Emittery()\n\t\t\t\t});\n\t\t\t\treturn this[emitteryPropertyName];\n\t\t\t}\n\n\t\t\tObject.defineProperty(target.prototype, emitteryPropertyName, {\n\t\t\t\tenumerable: false,\n\t\t\t\tget: getEmitteryProperty\n\t\t\t});\n\n\t\t\tconst emitteryMethodCaller = methodName => function (...args) {\n\t\t\t\treturn this[emitteryPropertyName][methodName](...args);\n\t\t\t};\n\n\t\t\tfor (const methodName of methodNames) {\n\t\t\t\tObject.defineProperty(target.prototype, methodName, {\n\t\t\t\t\tenumerable: false,\n\t\t\t\t\tvalue: emitteryMethodCaller(methodName)\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn target;\n\t\t};\n\t}\n\n\tconstructor() {\n\t\tanyMap.set(this, new Set());\n\t\teventsMap.set(this, new Map());\n\t\tproducersMap.set(this, new Map());\n\t}\n\n\ton(eventName, listener) {\n\t\tassertEventName(eventName);\n\t\tassertListener(listener);\n\t\tgetListeners(this, eventName).add(listener);\n\t\treturn this.off.bind(this, eventName, listener);\n\t}\n\n\toff(eventName, listener) {\n\t\tassertEventName(eventName);\n\t\tassertListener(listener);\n\t\tgetListeners(this, eventName).delete(listener);\n\t}\n\n\tonce(eventName) {\n\t\treturn new Promise(resolve => {\n\t\t\tassertEventName(eventName);\n\t\t\tconst off = this.on(eventName, data => {\n\t\t\t\toff();\n\t\t\t\tresolve(data);\n\t\t\t});\n\t\t});\n\t}\n\n\tevents(eventName) {\n\t\tassertEventName(eventName);\n\t\treturn iterator(this, eventName);\n\t}\n\n\tasync emit(eventName, eventData) {\n\t\tassertEventName(eventName);\n\n\t\tenqueueProducers(this, eventName, eventData);\n\n\t\tconst listeners = getListeners(this, eventName);\n\t\tconst anyListeners = anyMap.get(this);\n\t\tconst staticListeners = [...listeners];\n\t\tconst staticAnyListeners = [...anyListeners];\n\n\t\tawait resolvedPromise;\n\t\treturn Promise.all([\n\t\t\t...staticListeners.map(async listener => {\n\t\t\t\tif (listeners.has(listener)) {\n\t\t\t\t\treturn listener(eventData);\n\t\t\t\t}\n\t\t\t}),\n\t\t\t...staticAnyListeners.map(async listener => {\n\t\t\t\tif (anyListeners.has(listener)) {\n\t\t\t\t\treturn listener(eventName, eventData);\n\t\t\t\t}\n\t\t\t})\n\t\t]);\n\t}\n\n\tasync emitSerial(eventName, eventData) {\n\t\tassertEventName(eventName);\n\n\t\tconst listeners = getListeners(this, eventName);\n\t\tconst anyListeners = anyMap.get(this);\n\t\tconst staticListeners = [...listeners];\n\t\tconst staticAnyListeners = [...anyListeners];\n\n\t\tawait resolvedPromise;\n\t\t/* eslint-disable no-await-in-loop */\n\t\tfor (const listener of staticListeners) {\n\t\t\tif (listeners.has(listener)) {\n\t\t\t\tawait listener(eventData);\n\t\t\t}\n\t\t}\n\n\t\tfor (const listener of staticAnyListeners) {\n\t\t\tif (anyListeners.has(listener)) {\n\t\t\t\tawait listener(eventName, eventData);\n\t\t\t}\n\t\t}\n\t\t/* eslint-enable no-await-in-loop */\n\t}\n\n\tonAny(listener) {\n\t\tassertListener(listener);\n\t\tanyMap.get(this).add(listener);\n\t\treturn this.offAny.bind(this, listener);\n\t}\n\n\tanyEvent() {\n\t\treturn iterator(this);\n\t}\n\n\toffAny(listener) {\n\t\tassertListener(listener);\n\t\tanyMap.get(this).delete(listener);\n\t}\n\n\tclearListeners(eventName) {\n\t\tif (typeof eventName === 'string') {\n\t\t\tgetListeners(this, eventName).clear();\n\n\t\t\tconst producers = getEventProducers(this, eventName);\n\n\t\t\tfor (const producer of producers) {\n\t\t\t\tproducer.finish();\n\t\t\t}\n\n\t\t\tproducers.clear();\n\t\t} else {\n\t\t\tanyMap.get(this).clear();\n\n\t\t\tfor (const listeners of eventsMap.get(this).values()) {\n\t\t\t\tlisteners.clear();\n\t\t\t}\n\n\t\t\tfor (const producers of producersMap.get(this).values()) {\n\t\t\t\tfor (const producer of producers) {\n\t\t\t\t\tproducer.finish();\n\t\t\t\t}\n\n\t\t\t\tproducers.clear();\n\t\t\t}\n\t\t}\n\t}\n\n\tlistenerCount(eventName) {\n\t\tif (typeof eventName === 'string') {\n\t\t\treturn anyMap.get(this).size + getListeners(this, eventName).size +\n\t\t\t\tgetEventProducers(this, eventName).size + getEventProducers(this).size;\n\t\t}\n\n\t\tif (typeof eventName !== 'undefined') {\n\t\t\tassertEventName(eventName);\n\t\t}\n\n\t\tlet count = anyMap.get(this).size;\n\n\t\tfor (const value of eventsMap.get(this).values()) {\n\t\t\tcount += value.size;\n\t\t}\n\n\t\tfor (const value of producersMap.get(this).values()) {\n\t\t\tcount += value.size;\n\t\t}\n\n\t\treturn count;\n\t}\n\n\tbindMethods(target, methodNames) {\n\t\tif (typeof target !== 'object' || target === null) {\n\t\t\tthrow new TypeError('`target` must be an object');\n\t\t}\n\n\t\tmethodNames = defaultMethodNamesOrAssert(methodNames);\n\n\t\tfor (const methodName of methodNames) {\n\t\t\tif (target[methodName] !== undefined) {\n\t\t\t\tthrow new Error(`The property \\`${methodName}\\` already exists on \\`target\\``);\n\t\t\t}\n\n\t\t\tObject.defineProperty(target, methodName, {\n\t\t\t\tenumerable: false,\n\t\t\t\tvalue: this[methodName].bind(this)\n\t\t\t});\n\t\t}\n\t}\n}\n\nconst allEmitteryMethods = Object.getOwnPropertyNames(Emittery.prototype).filter(v => v !== 'constructor');\n\n// Subclass used to encourage TS users to type their events.\nEmittery.Typed = class extends Emittery {};\nObject.defineProperty(Emittery.Typed, 'Typed', {\n\tenumerable: false,\n\tvalue: undefined\n});\n\nmodule.exports = Emittery;\n","export function Enum<V extends string>(...values: V[]): { [K in V]: K };\nexport function Enum<\n    T extends { [_: string]: V },\n    V extends string\n>(definition: T): T;\nexport function Enum(...values: any[]): object {\n    if (typeof values[0] === \"string\") {\n        const result: any = {};\n        for (const value of values) {\n            result[value] = value;\n        }\n        return result;\n    } else {\n        return values[0];\n    }\n}\n\nexport type Enum<T extends object> = T[keyof T];\n\nexport namespace Enum {\n    export function ofKeys<\n        T extends { [_: string]: any}\n    >(e: T): { [K in keyof T]: K } {\n        const result: any = {};\n        for (const key of Object.keys(e)) {\n            result[key] = key;\n        }\n        return result;\n    }\n\n    export function keys<\n        T extends { [_: string]: any }\n    >(e: T): Array<keyof T> {\n        return Object.keys(e) as Array<keyof T>;\n    }\n\n    export function values<\n        T extends { [_: string]: any }\n    >(e: T): Array<Enum<T>> {\n        const result: Array<Enum<T>> = [];\n        for (const key of Object.keys(e)) {\n            result.push(e[key]);\n        }\n        return result;\n    }\n\n    export function isType<\n        T extends { [_: string]: any }\n    >(e: T, value: any): value is Enum<T> {\n        return values(e).indexOf(value) !== -1;\n    }\n}\n","/////////////////////\n\n// - human readable timestamps\n// - valid in URLs ?\n// - valid in files ?\n\nimport {\n\tTimestampUTCMs,\n\tHumanReadableTimestampUTCDays,\n\tHumanReadableTimestampUTCMinutes,\n\tHumanReadableTimestampUTCSeconds,\n\tHumanReadableTimestampUTCMs,\n} from './types'\n\nfunction get_UTC_timestamp_ms(now: Readonly<Date> = new Date()): TimestampUTCMs {\n\treturn (+now)\n}\n\n/////////////////////\n\nfunction get_human_readable_UTC_timestamp_days(now: Readonly<Date> = new Date()): HumanReadableTimestampUTCDays {\n\tconst YYYY = now.getUTCFullYear()\n\tconst MM = ('0' + (now.getUTCMonth() + 1)).slice(-2)\n\tconst DD = ('0' + now.getUTCDate()).slice(-2)\n\n\treturn `${YYYY}${MM}${DD}`\n}\n\nfunction get_human_readable_UTC_timestamp_minutes(now: Readonly<Date> = new Date()): HumanReadableTimestampUTCMinutes {\n\tconst hh = ('0' + now.getUTCHours()).slice(-2)\n\tconst mm = ('0' + now.getUTCMinutes()).slice(-2)\n\n\treturn get_human_readable_UTC_timestamp_days(now) + `_${hh}h${mm}`\n}\n\nfunction get_human_readable_UTC_timestamp_seconds(now: Readonly<Date> = new Date()): HumanReadableTimestampUTCSeconds {\n\tconst ss = ('0' + now.getUTCSeconds()).slice(-2)\n\n\treturn get_human_readable_UTC_timestamp_minutes(now) + `+${ss}`\n}\n\nfunction get_human_readable_UTC_timestamp_ms(now: Readonly<Date> = new Date()): HumanReadableTimestampUTCMs {\n\tconst mmm = ('00' + now.getUTCMilliseconds()).slice(-3)\n\n\treturn get_human_readable_UTC_timestamp_seconds(now) + `.${mmm}`\n}\n\n/////////////////////\n\n// https://space.stackexchange.com/questions/36628/utc-timestamp-format-for-launch-vehicles\n/*function get_space_timestamp_ms(now: Readonly<Date> = new Date()): string {\n\tconst YYYY = now.getUTCFullYear()\n\tconst MM = now.getUTCMonth()\n\tconst DD = ('0' + now.getUTCDate()).slice(-2)\n\tconst hh = ('0' + now.getUTCHours()).slice(-2)\n\tconst mm = ('0' + now.getUTCMinutes()).slice(-2)\n\tconst ss = ('0' + now.getUTCSeconds()).slice(-2)\n\tconst mmm = ('00' + now.getUTCMilliseconds()).slice(-3)\n\n\treturn `${DD} ${hh}:${mm}:${ss}.${mmm}`\n}*/\n\n/////////////////////\n\nexport {\n\tget_UTC_timestamp_ms,\n\n\tget_human_readable_UTC_timestamp_ms,\n\tget_human_readable_UTC_timestamp_seconds,\n\tget_human_readable_UTC_timestamp_minutes,\n\tget_human_readable_UTC_timestamp_days,\n}\n\n/////////////////////\n","export * from './types'\nexport * from './generate'\n","export const MSG_ENTRY = 'UWDT.v0' // TODO v1 one day!\n","export * from './entry'\nexport const LS_ROOT = 'UWDT' // !== UDA\nexport const LS_KEY_ENABLED = `${LS_ROOT}.enabled`\n","export const UNKNOWN_ORIGIN = '???'\n\nexport * from './entry'\nexport * from './content--start'\n","\nexport const JSON_UNDEFINED: string = 'undefined'\n// use this alternative to better validate typings. Obviously won't work.\n//export const JSON_UNDEFINED: unique symbol = Symbol('undefined')\n\nexport type StringifiedJSON = string | typeof JSON_UNDEFINED\n\nexport function sjson_parse(s: StringifiedJSON): any {\n\tif (s === JSON_UNDEFINED)\n\t\treturn undefined\n\n\treturn JSON.parse(s)\n}\n\nexport function sjson_stringify(obj: any): StringifiedJSON {\n\tif (obj === undefined)\n\t\treturn JSON_UNDEFINED\n\n\treturn JSON.stringify(obj)\n}\n\nexport function is_valid_stringified_json(sjson: StringifiedJSON): boolean {\n\tif (sjson === JSON_UNDEFINED)\n\t\treturn true\n\n\tif (typeof sjson !== 'string') {\n\t\tconsole.error(`is_valid_stringified_json failure 1!`, { sjson })\n\t\treturn false\n\t}\n\n\ttry {\n\t\tJSON.parse(sjson)\n\t\treturn true\n\t}\n\tcatch {\n\t\tconsole.error(`is_valid_stringified_json failure 2!`, { sjson })\n\t\treturn false\n\t}\n}\n\n// useful only due to enforcing types thanks to a symbol.\n// Should do nothing.\nexport function control_sjson(sjson: StringifiedJSON): string {\n\tif (sjson === JSON_UNDEFINED)\n\t\treturn 'undefined'\n\n\treturn sjson\n}\n","import { Enum } from 'typescript-string-enums'\nimport { TimestampUTCMs, get_UTC_timestamp_ms } from '@offirmo-private/timestamps'\n\nimport { StringifiedJSON, sjson_parse, sjson_stringify, is_valid_stringified_json } from '../utils/stringified-json'\nimport { UNKNOWN_ORIGIN } from '../consts'\nimport { Report } from '../messages'\nimport assert from 'tiny-invariant'\n\n////////////////////////////////////\n// This state represents the \"specification\" of the debug API config we want\n// - NOTE the local storage is the real spec!\n//   This is just a temporary copy.\n//   Hence some \"undefined\" = we haven't read the LS yet\n// - This is a SPEC so it may not have been applied yet,\n//   pending a reload to propagate the changes in the running code\n\n// tslint:disable-next-line: variable-name\nexport const OverrideType = Enum(\n\t'LogLevel',\n\t'Cohort',\n\t'boolean',\n\t//'string', // TODO useful?\n\t//'URL', ?\n\t// int ?\n\t// more?\n\t'any', // any JSON\n)\nexport type OverrideType = Enum<typeof OverrideType> // eslint-disable-line no-redeclare\n\nexport interface OverrideState {\n\tkey: string\n\ttype: OverrideType,\n\t// spec:\n\tis_enabled: boolean, // does the user wants to override this value?\n\tdefault_value_sjson: StringifiedJSON, // useful for display when disabled\n\tvalue_sjson: undefined | null | StringifiedJSON, // for convenience, we remember the value even when not enabled\n\t                                                 // null = no value was ever set (dynamically default to default value)\n\t                                                 // undefined = pending reading the LS\n\t// meta:\n\tlast_reported: TimestampUTCMs, // for cleaning TODO\n}\n\nexport interface State {\n\torigin: string,\n\tlast_visited: TimestampUTCMs, // for cleaning\n\tlast_interacted_with: TimestampUTCMs, // for cleaning\n\tis_injection_enabled: boolean | undefined, // undefined = pending reading the LS\n\toverrides: { [key: string]: OverrideState }\n}\n\n////////////////////////////////////\n\nexport function is_origin_eligible(origin: string): boolean {\n\tif (origin === UNKNOWN_ORIGIN)\n\t\treturn false\n\n\tif (origin.startsWith('chrome://'))\n\t\treturn false\n\n\tif (origin.startsWith('chrome-extension://'))\n\t\treturn false\n\n\tif (origin.startsWith('file://'))\n\t\treturn false // because no access to LS\n\n\tif (origin === 'null') // Firefox about:...\n\t\treturn false\n\n\treturn true\n}\n\nexport function is_eligible(state: Readonly<State>): boolean {\n\treturn is_origin_eligible(state.origin)\n}\n\nexport function is_injection_requested(state: Readonly<State>): State['is_injection_enabled'] {\n\treturn state.is_injection_enabled\n}\n\nexport function infer_override_type_from_key(key: string, value_sjson: null | StringifiedJSON): OverrideType {\n\tconst key_lc = key.toLowerCase()\n\t//console.log('INF', {key, key_lc})\n\n\tconst suffix_lc = (() => {\n\t\tconst dot = key_lc.split('.').slice(-1)[0]\n\t\tconst un = key_lc.split('_').slice(-1)[0]\n\t\tif (!dot)\n\t\t\treturn un\n\t\tif (!un)\n\t\t\treturn dot\n\t\treturn (un.length < dot.length) ? un : dot\n\t})()\n\n\tif (suffix_lc === 'loglevel' || suffix_lc === 'll')\n\t\treturn OverrideType.LogLevel\n\n\tif (suffix_lc === 'cohort' || suffix_lc === 'co')\n\t\treturn OverrideType.Cohort\n\n\t/* TODO check if string is useful\n\tif (suffix_lc === 'str')\n\t\treturn OverrideType.string\n\t */\n\n\t//console.log('INF no suffix match')\n\n\tlet bool_hint_separator: string | undefined\n\tif (key_lc.startsWith('is'))\n\t\tbool_hint_separator = key[2]\n\tif (key_lc.startsWith('has'))\n\t\tbool_hint_separator = key[3]\n\tif (key_lc.startsWith('should'))\n\t\tbool_hint_separator = key[6]\n\tif (key_lc.startsWith('was'))\n\t\tbool_hint_separator = key[3]\n\tif (key_lc.startsWith('will'))\n\t\tbool_hint_separator = key[4]\n\n\tif (bool_hint_separator\n\t\t&& (\n\t\t\tbool_hint_separator === '_'\n\t\t\t|| bool_hint_separator !== bool_hint_separator.toLowerCase()\n\t\t))\n\t\treturn OverrideType.boolean\n\n\t//console.log('INF no prefix match')\n\n\tif (!value_sjson)\n\t\treturn OverrideType.any\n\n\ttry {\n\t\tconst value = sjson_parse(value_sjson)\n\t\t//console.log('INF', {value, value_sjson, type: typeof value})\n\n\t\tif (typeof value === 'boolean')\n\t\t\treturn OverrideType.boolean\n\n\t\t/* TODO check if string is useful\n           if (typeof value === 'string')\n               return OverrideType.string\n      */\n\t\tif (value === 'not-enrolled')\n\t\t\treturn OverrideType.Cohort\n\t} catch {\n\t\t// ignore\n\t}\n\n\treturn OverrideType.any\n}\n\n////////////////////////////////////\n\nexport function create(origin: string): Readonly<State> {\n\treturn {\n\t\torigin,\n\t\tlast_visited: get_UTC_timestamp_ms(),\n\t\tlast_interacted_with: 0,\n\t\tis_injection_enabled: undefined,\n\t\toverrides: {},\n\t}\n}\n\nexport const DEMO_REPORTS: Report[] = [\n\t{\n\t\ttype: 'override',\n\t\tkey: 'fooExperiment.cohort',\n\t\tdefault_value_sjson: sjson_stringify('not-enrolled'),\n\t\texisting_override_sjson: sjson_stringify('variation-1'),\n\t},\n\t{\n\t\ttype: 'override',\n\t\tkey: 'fooExperiment.isSwitchedOn',\n\t\tdefault_value_sjson: sjson_stringify(true),\n\t\texisting_override_sjson: sjson_stringify(true), // up to date\n\t},\n\t{\n\t\ttype: 'override',\n\t\tkey: 'fooExperiment.logLevel',\n\t\tdefault_value_sjson: sjson_stringify('error'),\n\t\texisting_override_sjson: sjson_stringify('warning'),\n\t},\n\t{\n\t\ttype: 'override',\n\t\tkey: 'root.logLevel',\n\t\tdefault_value_sjson: sjson_stringify('error'),\n\t\texisting_override_sjson: null, // not enabled\n\t},\n\t{\n\t\ttype: 'override',\n\t\tkey: 'some_url',\n\t\tdefault_value_sjson: sjson_stringify('https://www.online-adventur.es/'),\n\t\t//existing_override_sjson: null,\n\t\texisting_override_sjson: sjson_stringify('https://offirmo-monorepo.netlify.com/'),\n\t\t//existing_override_sjson: 'some bad json',\n\t},\n\t{\n\t\ttype: 'override',\n\t\tkey: 'some_url_undef',\n\t\tdefault_value_sjson: 'undefined',\n\t\texisting_override_sjson: null, // not enabled\n\t}\n]\nexport function create_demo(origin: string): Readonly<State> {\n\tlet state = create(origin)\n\n\tstate = report_lib_injection(state, true)\n\n\tDEMO_REPORTS.forEach(report => state = report_debug_api_usage(state, report))\n\n\tstate = change_override_spec(state, 'fooExperiment.cohort', {\n\t\tvalue_sjson: sjson_stringify('variation-1'),\n\t\t//value_sjson: 'variation-1' // TEST bad JSON\n\t})\n\n\treturn state\n}\n\n// the content script reports that it injected the lib\nexport function report_lib_injection(state: Readonly<State>, is_injected: boolean): Readonly<State> {\n\treturn {\n\t\t...state,\n\t\tlast_visited: get_UTC_timestamp_ms(),\n\t\tis_injection_enabled: is_injected,\n\t}\n}\n\nexport function report_debug_api_usage(state: Readonly<State>, report: Report): Readonly<State> {\n\tswitch (report.type) {\n\t\tcase 'override': {\n\t\t\tconst { key, default_value_sjson, existing_override_sjson } = report\n\t\t\tassert(!!key, 'O.report_debug_api_usage override key')\n\t\t\tassert(is_valid_stringified_json(default_value_sjson), 'O.report_debug_api_usage default value !sjson')\n\t\t\tassert(existing_override_sjson === null || is_valid_stringified_json(existing_override_sjson), 'O.report_debug_api_usage existing value null or string')\n\n\t\t\tlet override: OverrideState = {\n\t\t\t\t...state.overrides[key],\n\t\t\t\tkey,\n\t\t\t\tis_enabled: !!existing_override_sjson,\n\t\t\t\ttype: infer_override_type_from_key(key, default_value_sjson),\n\t\t\t\tdefault_value_sjson,\n\t\t\t\tvalue_sjson: existing_override_sjson,\n\t\t\t\tlast_reported: get_UTC_timestamp_ms(),\n\t\t\t}\n\n\t\t\tstate = {\n\t\t\t\t...state,\n\t\t\t\toverrides: {\n\t\t\t\t\t...state.overrides,\n\t\t\t\t\t[key]: override,\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak\n\t\t}\n\t\tdefault:\n\t\t\tconsole.error(`O.report_debug_api_usage() unknown report type \"${report.type}\"!`)\n\t\t\tbreak\n\t}\n\n\treturn state\n}\n\n// user toggled it, for current tab\nexport function toggle_lib_injection(state: Readonly<State>): Readonly<State> {\n\treturn {\n\t\t...state,\n\t\tis_injection_enabled: !state.is_injection_enabled,\n\t\tlast_interacted_with: get_UTC_timestamp_ms(),\n\t}\n}\n\n// user touched an override\nexport function change_override_spec(state: Readonly<State>, key: string, partial: Readonly<Partial<OverrideState>>): Readonly<State> {\n\tconst current_override = state.overrides[key]\n\tconst partial2 = {\n\t\t...partial\n\t}\n\n\t// convenience: default value on activation for some fields\n\tif (  partial.is_enabled === true\n\t\t&& !partial.hasOwnProperty('value_sjson')\n\t\t&& current_override.value_sjson === null\n\t) {\n\t\tconsole.log('Smart default value on override activation:', {\n\t\t\ttype: current_override.type,\n\t\t\tdefault_value_sjson: current_override.default_value_sjson,\n\t\t\tcurrent_override,\n\t\t})\n\t\tswitch(current_override.type) {\n\t\t\tcase OverrideType.boolean:\n\t\t\t\t// if toggled on, it's obvious the user wants to change the value = opposite of the default\n\t\t\t\tpartial2.value_sjson = sjson_stringify(!Boolean(sjson_parse(current_override.default_value_sjson)))\n\t\t\t\tbreak\n\t\t\tcase OverrideType.LogLevel:\n\t\t\t\t// if toggled on, we usually want more logs\n\t\t\t\tpartial2.value_sjson = sjson_stringify('silly')\n\t\t\t\tbreak\n\t\t\tcase OverrideType.Cohort:\n\t\t\t\t// if toggled on, we usually want sth different\n\t\t\t\tif (current_override.default_value_sjson.startsWith('\"variation'))\n\t\t\t\t\tpartial2.value_sjson = sjson_stringify('not-enrolled')\n\t\t\t\telse\n\t\t\t\t\tpartial2.value_sjson = sjson_stringify('variation')\n\t\t\t\tbreak\n\t\t\tdefault:\n\t\t\t\tif (current_override.key.toLowerCase().endsWith('url'))\n\t\t\t\t\tpartial2.value_sjson = sjson_stringify('https://localhost:8080')\n\t\t\t\tbreak\n\t\t}\n\t}\n\n\treturn {\n\t\t...state,\n\t\toverrides: {\n\t\t\t...state.overrides,\n\t\t\t[key]: {\n\t\t\t\t...state.overrides[key],\n\t\t\t\t...partial2,\n\t\t\t}\n\t\t},\n\t\tlast_interacted_with: get_UTC_timestamp_ms(),\n\t}\n}\n\n////////////////////////////////////\n","import assert from 'tiny-invariant'\nimport { Enum } from 'typescript-string-enums'\nimport { TimestampUTCMs, get_UTC_timestamp_ms } from '@offirmo-private/timestamps'\n\nimport { UNKNOWN_ORIGIN } from '../consts'\nimport { Report } from '../messages'\nimport * as OriginState from './origin'\nimport { is_valid_stringified_json, StringifiedJSON }   from '../utils/stringified-json'\n\n////////////////////////////////////\n\n// tslint:disable-next-line: variable-name\nexport const SpecSyncStatus = Enum(\n\t'active-and-up-to-date',\n\t'changed-needs-reload',\n\t'inactive',\n\t'unknown', // happens when we install the extension or reload it during dev\n\t'unexpected-error',\n)\nexport type SpecSyncStatus = Enum<typeof SpecSyncStatus> // eslint-disable-line no-redeclare\n\n// what was reported the first time this override was used\nexport interface OverrideState {\n\tkey: string\n\tlast_reported: TimestampUTCMs // -1 = never\n\tlast_reported_value_sjson: undefined | null | StringifiedJSON\n}\n\nexport interface State {\n\tid: number,\n\turl: string, // for quick equality check TODO really needed?\n\torigin: string,\n\tlast_reported_injection_status: undefined | boolean,\n\toverrides: { [key: string]: OverrideState }\n}\n\n////////////////////////////////////\n\n/*\nexport function is_sync_status_hinting_at_a_reload(status: SpecSyncStatus): boolean {\n\tswitch(status) {\n\t\tcase 'active-and-up-to-date':\n\t\tcase 'inactive':\n\t\t\treturn false\n\t\tdefault:\n\t\t\treturn true\n\t}\n}\n*/\n\n// at last (re)load\nexport function was_injection_enabled(state: Readonly<State>): State['last_reported_injection_status'] {\n\treturn state.last_reported_injection_status\n}\n\nexport function get_global_switch_sync_status(state: Readonly<State>, origin_state: Readonly<OriginState.State>): SpecSyncStatus {\n\tif (OriginState.is_injection_requested(origin_state) !== was_injection_enabled(state))\n\t\treturn SpecSyncStatus['changed-needs-reload']\n\n\tif (!origin_state.is_injection_enabled)\n\t\treturn SpecSyncStatus.inactive\n\n\treturn SpecSyncStatus['active-and-up-to-date']\n}\n\nexport function get_override_sync_status(state: Readonly<State>, override_spec: OriginState.OverrideState): SpecSyncStatus {\n\tconst { key } = override_spec\n\tconst override = state.overrides[key]\n\tif (!override)\n\t\treturn SpecSyncStatus['unexpected-error']\n\n\tif (!override.last_reported)\n\t\treturn SpecSyncStatus.inactive\n\n\tif (override_spec.is_enabled && override_spec.value_sjson) {\n\t\tif (!is_valid_stringified_json(override_spec.value_sjson))\n\t\t\treturn SpecSyncStatus['unexpected-error']\n\t}\n\n\tconst was_enabled = override.last_reported_value_sjson !== null\n\tif (override_spec.is_enabled !== was_enabled)\n\t\treturn SpecSyncStatus['changed-needs-reload']\n\n\tif (!override_spec.is_enabled)\n\t\treturn SpecSyncStatus['active-and-up-to-date'] // we don't care about the value if !enabled\n\n\tif (override_spec.value_sjson !== override.last_reported_value_sjson)\n\t\treturn SpecSyncStatus['changed-needs-reload']\n\n\treturn SpecSyncStatus['active-and-up-to-date']\n}\n\nexport function get_sync_status(state: Readonly<State>, origin_state: Readonly<OriginState.State>): SpecSyncStatus {\n\tif (state.origin === UNKNOWN_ORIGIN) return SpecSyncStatus.inactive\n\n\tif (OriginState.is_injection_requested(origin_state) === undefined) {\n\t\t// ext freshly installed = we don't know what state is the tab in\n\t\treturn SpecSyncStatus.unknown\n\t}\n\n\tif (was_injection_enabled(state) === undefined) {\n\t\t// means the magic is not activated\n\t\t// This happen on extension install / reinstall\n\t\treturn SpecSyncStatus.unknown\n\t}\n\n\tconst global_switch_sync_status = get_global_switch_sync_status(state, origin_state)\n\tif (global_switch_sync_status !== SpecSyncStatus['active-and-up-to-date'])\n\t\treturn global_switch_sync_status\n\n\tlet non_inactive_count = 0\n\tfor (let key of Object.keys(origin_state.overrides)) {\n\t\tconst override_spec = origin_state.overrides[key]\n\t\tconst sync_status = get_override_sync_status(state, override_spec)\n\t\tif (sync_status !== SpecSyncStatus['active-and-up-to-date'] && sync_status !== SpecSyncStatus.inactive)\n\t\t\treturn sync_status\n\t\tif (sync_status !== SpecSyncStatus.inactive) non_inactive_count++\n\t}\n\n\treturn non_inactive_count || Object.keys(origin_state.overrides).length === 0\n\t\t? SpecSyncStatus['active-and-up-to-date']\n\t\t: SpecSyncStatus.inactive\n}\n\n/*\nexport function needs_reload(state: Readonly<State>, origin_state: Readonly<OriginState.State>): boolean {\n\treturn is_sync_status_hinting_at_a_reload(get_sync_status(state, origin_state))\n}\n*/\n\n////////////////////////////////////\n\nexport function create(tab_id: number): Readonly<State> {\n\treturn {\n\t\tid: tab_id,\n\t\turl: UNKNOWN_ORIGIN,\n\t\torigin: UNKNOWN_ORIGIN,\n\t\tlast_reported_injection_status: undefined,\n\t\toverrides: {},\n\t}\n}\n\n// if a tab gets created, or a navigation happens inside a tab.\n// If it's a navigation, the origin may change and the current page state may switch to another origin\n// thus we need to clear stuff\nexport function on_load(state: Readonly<State>): Readonly<State> {\n\treturn {\n\t\t...state,\n\t\t// a navigation may have happened, invalidate origin\n\t\turl: UNKNOWN_ORIGIN,\n\t\torigin: UNKNOWN_ORIGIN,\n\t\t// same, reset overrides\n\t\toverrides: {},\n\t}\n}\n\nexport function update_origin(previous_state: Readonly<State>, url: string, origin_state: Readonly<OriginState.State>): Readonly<State> {\n\tconst { origin } = origin_state\n\n\t//if (origin === previous_state.origin) return previous_state\n\n\tlet state = {\n\t\t...previous_state,\n\t\turl,\n\t\torigin,\n\t\toverrides: {}, // extra-safety, but we should have had on_load()\n\t}\n\n\tObject.keys(origin_state.overrides).forEach(key => {\n\t\tstate = ensure_override(state, origin_state.overrides[key])\n\t})\n\n\treturn state\n}\n\n// the content script reports that it injected the lib\nexport function report_lib_injection(state: Readonly<State>, is_injected: boolean): Readonly<State> {\n\tif (state.last_reported_injection_status === is_injected) return state\n\n\treturn {\n\t\t...state,\n\t\tlast_reported_injection_status: is_injected,\n\t}\n}\n\nexport function ensure_override(state: Readonly<State>, override_spec: OriginState.OverrideState): Readonly<State> {\n\tconst { key } = override_spec\n\n\tstate = {\n\t\t...state,\n\t\toverrides: {\n\t\t\t...state.overrides\n\t\t}\n\t}\n\tstate.overrides[key] = state.overrides[key] || {\n\t\tkey,\n\t\tlast_reported: -1,\n\t\tlast_reported_value_sjson: undefined,\n\t}\n\n\treturn state\n}\n\nexport function report_debug_api_usage(state: Readonly<State>, report: Report): Readonly<State> {\n\tswitch (report.type) {\n\t\tcase 'override': {\n\t\t\tconst { key, existing_override_sjson } = report\n\t\t\tassert(!!key, 'T.report_debug_api_usage override key')\n\n\t\t\tlet override: OverrideState = {\n\t\t\t\t...state.overrides[key],\n\t\t\t\tkey,\n\t\t\t\tlast_reported: get_UTC_timestamp_ms(),\n\t\t\t\tlast_reported_value_sjson: existing_override_sjson,\n\t\t\t}\n\n\t\t\tstate = {\n\t\t\t\t...state,\n\t\t\t\toverrides: {\n\t\t\t\t\t...state.overrides,\n\t\t\t\t\t[key]: override,\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak\n\t\t}\n\t\tdefault:\n\t\t\tconsole.error(`T.report_debug_api_usage() unknown report type \"${report.type}\"!`)\n\t\t\tbreak\n\t}\n\n\treturn state\n}\n\n////////////////////////////////////\n","import assert from 'tiny-invariant'\nimport { browser, Tabs } from 'webextension-polyfill-ts'\n\nimport {UNKNOWN_ORIGIN} from '../common/consts'\nimport { is_origin_eligible } from '../common/state/origin'\n\nexport function query_active_tab(): Promise<Readonly<Tabs.Tab>> {\n\treturn browser.tabs.query({active: true, currentWindow: true})\n\t\t.then(([active_tab, ...other_tabs]: Tabs.Tab[]) => {\n\t\t\tif (!active_tab) {\n\t\t\t\tconsole.error(`\nPlease do not manually refresh the extension background tab!\nPlease use the refresh button in the extension UI instead!\n`)\n\t\t\t\tassert(active_tab, 'query_active_tab()')\n\t\t\t}\n\n\t\t\tassert(active_tab.id, 'query_active_tab(): tab id') // typings seems to imply it could be undef\n\n\t\t\treturn active_tab\n\t\t})\n}\n\n\n\nexport function get_origin(url: string): string {\n\tif (url === UNKNOWN_ORIGIN)\n\t\treturn UNKNOWN_ORIGIN\n\n\ttry {\n\t\tconst origin = (new URL(url)).origin || UNKNOWN_ORIGIN\n\n\t\tif (!is_origin_eligible(origin))\n\t\t\treturn UNKNOWN_ORIGIN\n\n\t\treturn origin\n\t}\n\tcatch {\n\t\treturn UNKNOWN_ORIGIN\n\t}\n}\n","import assert from 'tiny-invariant'\nimport { Tabs, Runtime } from 'webextension-polyfill-ts'\n\nimport { UNKNOWN_ORIGIN } from '../common/consts'\nimport * as OriginState from '../common/state/origin'\nimport * as TabState from '../common/state/tab'\nimport { Report } from '../common/messages'\nimport { get_origin, query_active_tab } from './utils'\n\n////////////////////////////////////\n\nexport interface State {\n\tports: { [channel_id: string]: Readonly<Runtime.Port> },\n\n\tactive_tab_id: undefined | number,\n\tactive_tab: Promise<Readonly<Tabs.Tab>>,\n\n\torigins: {\n\t\t[origin: string]: OriginState.State,\n\t}\n\n\ttabs: {\n\t\t[id: number]: TabState.State,\n\t}\n}\n\n////////////////////////////////////\n\nexport function get_active_tab_id(state: Readonly<State>, from: string): number {\n\tconst { active_tab_id } = state\n\tassert(active_tab_id !== undefined, `get_active_tab_id() from \"${from}\"`)\n\treturn active_tab_id!\n}\n\nexport function get_tab_origin(state: Readonly<State>, tab_id: number): string {\n\tconst tab_state: TabState.State = state.tabs[tab_id]\n\tassert(!!tab_state, 'get_tab_origin tab state')\n\treturn tab_state.origin\n}\n\nexport function get_active_origin_state(state: Readonly<State>, {should_assert = true} = {}): OriginState.State {\n\tconst active_tab_id = get_active_tab_id(state, 'get_active_origin_state()')\n\tconst current_tab_origin = get_tab_origin(state, active_tab_id)\n\tassert(!!current_tab_origin, 'get_active_origin_state(): current_tab_origin')\n\n\treturn state.origins[current_tab_origin]\n}\n\nexport function get_active_tab_state(state: Readonly<State>): TabState.State {\n\tconst active_tab_id = get_active_tab_id(state, 'get_active_tab_state()')\n\n\treturn state.tabs[active_tab_id]\n}\n\nexport function get_port(state: Readonly<State>, channel_id: string): Readonly<Runtime.Port> | undefined {\n\treturn state.ports[channel_id]\n}\n\n////////////////////////////////////\n\nexport function create(): Readonly<State> {\n\treturn {\n\t\tports: {},\n\n\t\tactive_tab_id: undefined,\n\t\tactive_tab: new Promise(() => {}),\n\n\t\torigins: {\n\t\t\t[UNKNOWN_ORIGIN]: OriginState.create(UNKNOWN_ORIGIN),\n\t\t\t//[LOCAL_DEMO_ORIGIN]: OriginState.create_demo(LOCAL_DEMO_ORIGIN),\n\t\t},\n\n\t\ttabs: {},\n\t}\n}\n\n// we need to store and share ports for sharing across files\nexport function update_port(state: Readonly<State>, channel_id: string, port: Readonly<Runtime.Port> | null): Readonly<State> {\n\tif (port)\n\t\tstate.ports[channel_id] = port\n\telse\n\t\tdelete state.ports[channel_id]\n\n\treturn state\n}\n\n// tab lifecycle events happen in any order\nexport function ensure_tab(state: Readonly<State>, source: string, id: number): Readonly<State> {\n\tif (state.tabs[id]) return state\n\n\tconsole.log(` Tab #${id} discovered through ${source}`)\n\treturn {\n\t\t...state,\n\t\ttabs: {\n\t\t\t...state.tabs,\n\t\t\t[id]: TabState.create(id),\n\t\t},\n\t}\n}\n\n// we need to track the currently active tab,\n// mainly to update the extension icon\nexport function on_tab_activated(state: Readonly<State>, id: number, tab_hint?: Readonly<Tabs.Tab>): Readonly<State> {\n\treturn {\n\t\t...state,\n\t\tactive_tab_id: id,\n\t\tactive_tab: tab_hint ? Promise.resolve(tab_hint) : query_active_tab(),\n\t\ttabs: {\n\t\t\t...state.tabs,\n\t\t\t[id]: state.tabs[id] || TabState.create(id),\n\t\t},\n\t}\n}\n\n// we need to track tab origins\n// to properly apply the settings for this origin\n// UNKNOWN_ORIGIN is for non-browsing tabs, ex. browser settings, which have no URL\nexport function update_tab_origin(state: Readonly<State>, tab_id: number, url: string = UNKNOWN_ORIGIN): Readonly<State> {\n\tif (state.tabs[tab_id].url === url) return state // up to date\n\n\tconst origin = get_origin(url)\n\n\tstate = {\n\t\t...state,\n\t\torigins: {\n\t\t\t...state.origins,\n\t\t\t[origin]: state.origins[origin] || OriginState.create(origin),\n\t\t},\n\t}\n\n\tstate = {\n\t\t...state,\n\t\ttabs: {\n\t\t\t...state.tabs,\n\t\t\t[tab_id]: TabState.update_origin(state.tabs[tab_id], url, state.origins[origin]),\n\t\t},\n\t}\n\n\treturn state\n}\n\nexport function on_tab_loading(state: Readonly<State>, tab_id: number): Readonly<State> {\n\treturn {\n\t\t...state,\n\t\ttabs: {\n\t\t\t...state.tabs,\n\t\t\t[tab_id]: TabState.on_load(state.tabs[tab_id]),\n\t\t},\n\t}\n}\n\nexport function report_lib_injection(state: Readonly<State>, tab_id: number, is_injected: boolean): Readonly<State> {\n\tconst { origin } = state.tabs[tab_id]\n\treturn {\n\t\t...state,\n\t\torigins: {\n\t\t\t...state.origins,\n\t\t\t[origin]: OriginState.report_lib_injection(state.origins[origin], is_injected),\n\t\t},\n\t\ttabs: {\n\t\t\t...state.tabs,\n\t\t\t[tab_id]: TabState.report_lib_injection(state.tabs[tab_id], is_injected),\n\t\t},\n\t}\n}\n\nexport function toggle_lib_injection(state: Readonly<State>, tab_id: number): Readonly<State> {\n\tassert(tab_id >= 0, 'toggle_lib_injection: tab_id')\n\tconst tab_origin = state.tabs[tab_id].origin\n\tassert(!!tab_origin, 'toggle_lib_injection: tab_origin')\n\n\treturn {\n\t\t...state,\n\t\torigins: {\n\t\t\t...state.origins,\n\t\t\t[tab_origin]: OriginState.toggle_lib_injection(state.origins[tab_origin]),\n\t\t}\n\t}\n}\n\nexport function report_debug_api_usage(state: Readonly<State>, tab_id: number, reports: Report[]): Readonly<State> {\n\tlet tab_state = state.tabs[tab_id]\n\tassert(!!tab_state, 'report_debug_api_usage: tab_state')\n\tlet origin_state = state.origins[tab_state.origin]\n\tassert(!!origin_state, 'report_debug_api_usage: origin_state')\n\n\treports.forEach((report: Report) => {\n\t\torigin_state = OriginState.report_debug_api_usage(origin_state, report)\n\t\ttab_state = TabState.report_debug_api_usage(tab_state, report)\n\t})\n\n\treturn {\n\t\t...state,\n\t\torigins: {\n\t\t\t...state.origins,\n\t\t\t[tab_state.origin]: origin_state,\n\t\t},\n\t\ttabs: {\n\t\t\t...state.tabs,\n\t\t\t[tab_id]: tab_state,\n\t\t}\n\t}\n}\n\nexport function change_override_spec(state: Readonly<State>, tab_id: number, key: string, partial: Readonly<Partial<OriginState.OverrideState>>): Readonly<State> {\n\tassert(tab_id >= 0, 'change_override_spec: tab_id')\n\tconst tab_origin = state.tabs[tab_id].origin\n\tassert(!!tab_origin, 'change_override_spec: tab_origin')\n\n\treturn {\n\t\t...state,\n\t\torigins: {\n\t\t\t...state.origins,\n\t\t\t[tab_origin]: OriginState.change_override_spec(state.origins[tab_origin], key, partial),\n\t\t}\n\t}\n}\n\n////////////////////////////////////\n","import EventEmitter from 'emittery'\nimport assert from 'tiny-invariant'\nimport { Tabs, Runtime } from 'webextension-polyfill-ts'\n\nimport * as OriginState from \"../common/state/origin\";\nimport * as TabState from \"../common/state/tab\";\nimport * as UIState from \"../common/state/ui\";\nimport { Report } from '../common/messages'\nimport { query_active_tab } from './utils'\nimport * as State from './state'\n\n////////////////////////////////////\n\nlet state: State.State = State.create()\nconsole.log(' initial state', state)\n\nexport const icon_emitter = new EventEmitter()\nexport const ui_emitter = new EventEmitter()\nexport const cscript_emitter = new EventEmitter()\n\n////////////////////////////////////\n\nexport function get_active_tab_id(from: string): number {\n\treturn State.get_active_tab_id(state, from)\n}\n\nexport function get_port(channel_id: string): ReturnType<typeof State.get_port> {\n\treturn State.get_port(state, channel_id)\n}\n\nexport function get_tab_origin(tab_id: number) {\n\treturn state.tabs[tab_id].origin\n}\n\nexport function get_active_tab_sync_status(): TabState.SpecSyncStatus {\n\tassert(get_active_tab_id('get_active_tab_sync_status()') !== undefined)\n\tconst t = State.get_active_tab_state(state)\n\tconst o = State.get_active_origin_state(state)\n\n\treturn TabState.get_sync_status(t, o)\n}\n\nexport function get_active_origin_state() {\n\tconst current_tab_id = get_active_tab_id('get_active_origin_state()')\n\n\tconst current_tab_origin = get_tab_origin(current_tab_id)\n\tassert(current_tab_origin, 'get_active_origin_state: current_tab_origin')\n\n\treturn state.origins[current_tab_origin]\n}\n\nexport function get_active_tab_ui_state(): UIState.State {\n\tassert(get_active_tab_id('get_active_tab_ui_state()') !== undefined)\n\tconst tab = State.get_active_tab_state(state)\n\tconst origin = State.get_active_origin_state(state)\n\treturn {\n\t\ttab,\n\t\torigin,\n\t}\n}\n\n////////////////////////////////////\n\nexport function on_init(): void {\n\tconsole.group(' on_init')\n\tconsole.log('before', state)\n\n\t// Convenience for extension install and dev reload,\n\t// manual query to properly get info for the current tab\n\t// for whom we missed the creation events.\n\t// Subsequent new tabs / tab change\n\t// will be detected and handled normally.\n\tquery_active_tab().then(tab => {\n\t\tconsole.group(' on_init (2)', tab)\n\t\ton_tab_activated(tab.id!, tab)\n\t\tconsole.groupEnd()\n\t})\n\n\tconsole.log('after', state)\n\tconsole.groupEnd()\n}\n\nexport function ensure_tab(source: string, id: number, tab_hint?: Readonly<Tabs.Tab>): void {\n\tconsole.group(' ensure_tab', {id, tab_hint})\n\tconsole.log('before', state)\n\n\tstate = State.ensure_tab(state, source, id)\n\n\t// no react, we should get tab events soon\n\n\tconsole.log('after', state)\n\tconsole.groupEnd()\n}\n\nexport function on_tab_activated(id: number, tab_hint?: Readonly<Tabs.Tab>): void {\n\tconsole.group(' on_tab_activated', {id, tab_hint})\n\tconsole.log('before', state)\n\n\tstate = State.on_tab_activated(state, id, tab_hint)\n\n\t// get the origin as soon as possible\n\tstate.active_tab.then(tab => {\n\t\tconst { id: active_tab_id, url } = tab\n\t\tif (active_tab_id !== id) {\n\t\t\t// outdated\n\t\t\tconsole.groupCollapsed(' on_tab_activated (2a): outdated tab info received, ignoring.', {active_tab_id, id})\n\t\t\treturn\n\t\t}\n\n\t\tconsole.group(' on_tab_activated (2b): updating origin', {active_tab_id, url})\n\t\tif (url)\n\t\t\tupdate_tab_origin(id, url)\n\t\tconsole.groupEnd()\n\t})\n\n\ticon_emitter.emit('change', state)\n\n\tconsole.log('after', state)\n\tconsole.groupEnd()\n}\n\nexport function update_tab_origin(tab_id: number, url: string): void {\n\tconsole.group(' update_tab_origin', {tabId: tab_id, url})\n\tconsole.log('before', state)\n\n\tconst old_state = state\n\tstate = State.update_tab_origin(state, tab_id, url)\n\n\tif (old_state !== state && state.active_tab_id !== undefined) {\n\t\ticon_emitter.emit('change', state)\n\t\tui_emitter.emit('change', state)\n\t}\n\n\tconsole.log('after', state)\n\tconsole.groupEnd()\n}\n\nexport function update_port(channel_id: string, port: Readonly<Runtime.Port> | null): void {\n\tconsole.group(' update_port', { channel_id, port })\n\tconsole.log('before', state)\n\n\tstate = State.update_port(state, channel_id, port)\n\n\tif (port) {\n\t\tport.onDisconnect.addListener(() => update_port(channel_id, null))\n\n\t\tif (channel_id === 'popup' || channel_id === 'devtools')\n\t\t\tui_emitter.emit('change', state)\n\t}\n\n\tconsole.log('after', state)\n\tconsole.groupEnd()\n}\n\nexport function on_tab_loading(tab_id: number): void {\n\tconsole.group(' on_tab_loading', {tab_id})\n\tconsole.log('before', state)\n\n\tstate = State.on_tab_loading(state, tab_id)\n\n\tif (state.active_tab_id === tab_id)\n\t\ticon_emitter.emit('change', state)\n\n\tconsole.log('after', state)\n\tconsole.groupEnd()\n}\n\nexport function report_lib_injection(tab_id: number, is_injected: boolean): void {\n\tconsole.group(' report_lib_injection', {tab_id, is_injected, known_active_tab: state.active_tab_id})\n\tconsole.log('before', state)\n\n\tstate = State.report_lib_injection(state, tab_id, is_injected)\n\n\tif (state.active_tab_id === tab_id) {\n\t\ticon_emitter.emit('change', state)\n\t\tui_emitter.emit('change', state)\n\t}\n\n\tconsole.log('after', state)\n\tconsole.groupEnd()\n}\n\nexport function toggle_lib_injection(tab_id: number): void {\n\tconsole.group(' toggle_lib_injection')\n\tconsole.log('before', state)\n\n\tstate = State.toggle_lib_injection(state, tab_id)\n\n\ticon_emitter.emit('change', state)\n\tui_emitter.emit('change', state)\n\tcscript_emitter.emit('change', state)\n\n\tconsole.log('after', state)\n\tconsole.groupEnd()\n}\n\nexport function report_debug_api_usage(tab_id: number, reports: Report[]): void {\n\tconsole.group(' report_debug_api_usage', { reports })\n\tconsole.log('before', state)\n\n\tstate = State.report_debug_api_usage(state, tab_id, reports)\n\n\tif (state.active_tab_id === tab_id) {\n\t\ticon_emitter.emit('change', state)\n\t\tui_emitter.emit('change', state)\n\t}\n\n\tconsole.log('after', state)\n\tconsole.groupEnd()\n}\n\nexport function change_override_spec(tab_id: number, key: string, partial: Readonly<Partial<OriginState.OverrideState>>) {\n\tconsole.group(' change_override_spec', { tab_id, key, partial })\n\tconsole.log('before', state)\n\n\tstate = State.change_override_spec(state, tab_id, key, partial)\n\n\ticon_emitter.emit('change', state)\n\tui_emitter.emit('change', state)\n\tcscript_emitter.emit('change', state)\n\n\tconsole.log('after', state)\n\tconsole.groupEnd()\n}\n\n////////////////////////////////////\n\n// convenience\nexport { State } from './state'\n","function areInputsEqual(newInputs, lastInputs) {\n    if (newInputs.length !== lastInputs.length) {\n        return false;\n    }\n    for (var i = 0; i < newInputs.length; i++) {\n        if (newInputs[i] !== lastInputs[i]) {\n            return false;\n        }\n    }\n    return true;\n}\n\nfunction memoizeOne(resultFn, isEqual) {\n    if (isEqual === void 0) { isEqual = areInputsEqual; }\n    var lastThis;\n    var lastArgs = [];\n    var lastResult;\n    var calledOnce = false;\n    function memoized() {\n        var newArgs = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            newArgs[_i] = arguments[_i];\n        }\n        if (calledOnce && lastThis === this && isEqual(newArgs, lastArgs)) {\n            return lastResult;\n        }\n        lastResult = resultFn.apply(this, newArgs);\n        calledOnce = true;\n        lastThis = this;\n        lastArgs = newArgs;\n        return lastResult;\n    }\n    return memoized;\n}\n\nexport default memoizeOne;\n","import { MSG_ENTRY } from '../consts/entry'\nimport { StringifiedJSON } from '../utils/stringified-json'\n\n////////////////////////////////////\n\nexport interface OverrideReport {\n\ttype: 'override'\n\tkey: string\n\tdefault_value_sjson: StringifiedJSON\n\texisting_override_sjson: null | StringifiedJSON,\n}\nexport interface LoggerReport { // TODO needed?\n\ttype: 'logger'\n}\nexport interface CommandReport {\n\ttype: 'command'\n}\nexport type Report = OverrideReport | LoggerReport | CommandReport\n\n////////////////////////////////////\n\nexport const MSG_TYPE__REPORT_DEBUG_API_USAGE = 'report-usage'\nexport function create_msg_report_debug_api_usage(reports: Report[]) {\n\treturn {\n\t\t[MSG_ENTRY]: {\n\t\t\ttype: MSG_TYPE__REPORT_DEBUG_API_USAGE,\n\t\t\treports,\n\t\t}\n\t}\n}\n","import { MSG_ENTRY } from '../consts'\nimport * as OriginState from '../state/origin'\nimport * as UIState from '../state/ui'\n\nexport const MSG_TYPE__TOGGLE_LIB_INJECTION = 'toggle-lib-injection'\nexport function create_msg_toggle_lib_injection() {\n\treturn {\n\t\t[MSG_ENTRY]: {\n\t\t\ttype: MSG_TYPE__TOGGLE_LIB_INJECTION,\n\t\t}\n\t}\n}\n\nexport const MSG_TYPE__REPORT_IS_LIB_INJECTED = 'report-is-lib-injected'\nexport function create_msg_report_is_lib_injected(url: string, is_injected: boolean) {\n\treturn {\n\t\t[MSG_ENTRY]: {\n\t\t\ttype: MSG_TYPE__REPORT_IS_LIB_INJECTED,\n\t\t\turl, // needed because this event may follow updated=loading which resets the url\n\t\t\tis_injected,\n\t\t}\n\t}\n}\n\nexport const MSG_TYPE__OVERRIDE_SPEC_CHANGED = 'change-override-spec'\nexport function create_msg_change_override_spec(key: string, partial: Readonly<Partial<OriginState.OverrideState>>) {\n\treturn {\n\t\t[MSG_ENTRY]: {\n\t\t\ttype: MSG_TYPE__OVERRIDE_SPEC_CHANGED,\n\t\t\tkey,\n\t\t\tpartial,\n\t\t}\n\t}\n}\n\nexport const MSG_TYPE__UPDATE_UI_STATE = 'update-ui-state'\nexport function create_msg_update_ui_state(state: Readonly<UIState.State>) {\n\treturn {\n\t\t[MSG_ENTRY]: {\n\t\t\ttype: MSG_TYPE__UPDATE_UI_STATE,\n\t\t\tstate,\n\t\t}\n\t}\n}\n\nexport const MSG_TYPE__UPDATE_LS_STATE = 'update-ls-state'\nexport function create_msg_update_ls_state(kv: Readonly<{ [k: string]: string | null }>) {\n\treturn {\n\t\t[MSG_ENTRY]: {\n\t\t\ttype: MSG_TYPE__UPDATE_LS_STATE,\n\t\t\tkv,\n\t\t}\n\t}\n}\n\nexport const MSG_TYPE__REQUEST_CURRENT_PAGE_RELOAD = 'request-current-page-reload'\nexport function create_msg_request_reload() {\n\treturn {\n\t\t[MSG_ENTRY]: {\n\t\t\ttype: MSG_TYPE__REQUEST_CURRENT_PAGE_RELOAD,\n\t\t}\n\t}\n}\n\nexport * from './report-usage'\n","export const LS_ROOT = 'UDA'\n","import { LS_ROOT } from '../consts'\n\nexport { LS_ROOT } from '../consts'\n\nexport function getOverrideKeyForLogger(name: string): string {\n\treturn `logger.${name || 'default'}.logLevel`\n}\n\nexport function getLSKeyForOverride(key: string): string {\n\t// should we put v1 somewhere? no, most likely overkill.\n\treturn `${LS_ROOT}.override.${key}`\n}\n","import { browser } from 'webextension-polyfill-ts'\nimport memoize_one from 'memoize-one'\n\nimport * as Flux from './flux'\nimport { control_sjson } from '../common/utils/stringified-json'\nimport { LS_KEY_ENABLED } from '../common/consts'\nimport { create_msg_update_ui_state, create_msg_update_ls_state } from '../common/messages'\nimport { SpecSyncStatus } from \"../common/state/tab\";\nimport { getLSKeyForOverride } from '@offirmo/universal-debug-api-browser/src/v1/keys'\n\n////////////////////////////////////\n\nconst render_webext_icon = memoize_one(function render_webext_icon(sync_status) {\n\tconsole.log(' render_webext_icon', { sync_status })\n\n\tlet text = ''\n\tlet color = \"#ff0000\"\n\n\tswitch(sync_status) {\n\t\tcase SpecSyncStatus[\"unexpected-error\"]:\n\t\t\tbreak\n\n\t\tcase SpecSyncStatus.inactive:\n\t\tcase SpecSyncStatus.unknown: // because happen when the ext is freshly installed or reloaded in dev = most likely inactive\n\t\t\ttext = ''\n\t\t\tbreak\n\n\t\tcase SpecSyncStatus[\"changed-needs-reload\"]:\n\t\t\ttext = ''\n\t\t\tcolor = '#f3b200'\n\t\t\tbreak\n\n\t\tcase SpecSyncStatus[\"active-and-up-to-date\"]:\n\t\t\ttext = ''\n\t\t\tcolor = \"#00AA00\"\n\t\t\tbreak\n\n\t\tdefault:\n\t\t\tconsole.error('Unknown sync_status!', { sync_status })\n\t\t\tbreak\n\t}\n\n\t// Note: it sets it for ALL tabs\n\tbrowser.browserAction.setBadgeText({ text })\n\tbrowser.browserAction.setBadgeBackgroundColor({ color })\n})\n\nFlux.icon_emitter.on('change', () => {\n\tconst tab_sync_status = Flux.get_active_tab_sync_status()\n\tconsole.log(' icon_emitter.onChange', { tab_sync_status, tab_id: Flux.get_active_tab_id('Flux.icon_emitter') })\n\trender_webext_icon(tab_sync_status)\n})\n\n////////////////////////////////////\n\nfunction update_ui_state() {\n\tconst port = Flux.get_port('popup')\n\tif (!port) {\n\t\t// popup is closed\n\t\tconsole.log(' update_ui_state: no UI')\n\t\treturn\n\t}\n\tconsole.group(' update_ui_state')\n\n\tconst ui_state = Flux.get_active_tab_ui_state()\n\tconsole.log(' dispatching state to UI:', ui_state)\n\tport.postMessage(\n\t\t\tcreate_msg_update_ui_state(\n\t\t\t\tui_state,\n\t\t\t)\n\t\t)\n\tconsole.groupEnd()\n}\n\nFlux.ui_emitter.on('change', () => {\n\tupdate_ui_state()\n})\n\n// TODO persist settings\n//    browser.storage.local.set({'address': req.address})\n\n\n////////////////////////////////////\n\nfunction propagate_lib_config() {\n\tconst current_tab_id = Flux.get_active_tab_id('from propagate_lib_config()')\n\tconst origin_state = Flux.get_active_origin_state()\n\tconsole.group(' propagate_lib_config', {current_tab_id, origin_state})\n\n\tconst kv: { [k: string]: string | null } = {}\n\n\tkv[LS_KEY_ENABLED] = origin_state.is_injection_enabled ? 'true' : null\n\n\tObject.values(origin_state.overrides).forEach(spec => {\n\t\tconst { key, is_enabled, value_sjson } = spec\n\t\tconst LSKey = getLSKeyForOverride(key)\n\t\tkv[LSKey] = is_enabled\n\t\t\t? value_sjson\n\t\t\t\t? control_sjson(value_sjson)\n\t\t\t\t: null\n\t\t\t: null\n\t})\n\n\tconsole.log(` dispatching origin config to content-script of tab#${current_tab_id}`, kv)\n\tbrowser.tabs.sendMessage(\n\t\t\tcurrent_tab_id,\n\t\t\tcreate_msg_update_ls_state(\n\t\t\t\tkv\n\t\t\t)\n\t\t)\n\t\t.catch(err => {\n\t\t\tconst { message } = err\n\t\t\tif (message.includes('Receiving end does not exist')) {\n\t\t\t\t// the content script wasn't executed\n\t\t\t\t// most likely the extension just kot installed\n\t\t\t\t// or reloaded (dev)\n\t\t\t\t// ignore.\n\t\t\t}\n\t\t\telse {\n\t\t\t\tconsole.error(`propagate_lib_config when dispatching to tab#${current_tab_id}`, err)\n\t\t\t}\n\t\t})\n\tconsole.groupEnd()\n}\n\nFlux.cscript_emitter.on('change', () => {\n\tpropagate_lib_config()\n})\n\n////////////////////////////////////\n","import assert from 'tiny-invariant'\nimport { browser } from 'webextension-polyfill-ts'\nimport Deferred from '@offirmo/deferred'\n\nimport * as Flux from './flux'\nimport './react'\n\nimport { MSG_ENTRY } from '../common/consts'\nimport {\n\tMSG_TYPE__REPORT_IS_LIB_INJECTED,\n\tMSG_TYPE__TOGGLE_LIB_INJECTION,\n\tMSG_TYPE__REQUEST_CURRENT_PAGE_RELOAD,\n\tMSG_TYPE__REPORT_DEBUG_API_USAGE,\n\tMSG_TYPE__OVERRIDE_SPEC_CHANGED,\n} from '../common/messages'\nimport { query_active_tab } from './utils'\n\nconst LIB = ' UWDT/bg'\n// TODO clean logs!\n\nconsole.log(`[${LIB}.${+Date.now()}] Hello from background!`, browser)\n\nconst extension_inited = new Deferred<string>()\nlet is_extension_inited = false\nextension_inited.then((from: string) => {\n\tis_extension_inited = true\n\tconsole.log(` extension inited!`, {from})\n})\nsetTimeout(() => {\n\t\tif (is_extension_inited) return\n\n\t\t// should never happen\n\t\tconsole.error(' Timeout (2) waiting for extension init!')\n\t\textension_inited.resolve('gave up')\n\t},\n\t120 * 1000\n)\nsetTimeout(() => {\n\t\tif (is_extension_inited) return\n\n\t\t// should never happen\n\t\tconsole.error(' Timeout (1) waiting for extension init!')\n\t\textension_inited.resolve(query_active_tab().then(() => 'attempt 2'))\n\t},\n\t30 * 1000\n)\nfunction once_extension_init_done<T>(cb: () => T): Promise<T> {\n\t// we want sync as much as possible\n\tif (is_extension_inited)\n\t\treturn Promise.resolve(cb())\n\n\treturn extension_inited.then(cb)\n}\n\nFlux.on_init()\nextension_inited.resolve(query_active_tab().then(() => 'attempt 1'))\n\n////////////////////////////////////\n// listen to some events\n// https://developer.browser.com/extensions/tabs\n\nbrowser.runtime.onInstalled.addListener(function() {\n\tconsole.group(' on extension installed')\n\t// we used to have some stuff here\n\t// but this event is unreliable: not seen on browser (re)start\n\tconsole.groupEnd()\n});\n\nbrowser.tabs.onCreated.addListener((tab) => {\n\tconsole.group(' on tab created', { tab })\n\tif (!tab.id)\n\t\tconsole.warn('tab without id???')\n\telse\n\t\tFlux.ensure_tab('onCreated event', tab.id, tab)\n\tconsole.groupEnd()\n})\n\n// note that we can totally receive this event\n// without having received any create() or activated()\n// for ex. the extension just got installed\n// and then anon-active tab updates its favicon = we receive this event\nbrowser.tabs.onUpdated.addListener((tab_id, change_info, tab) => {\n\tconsole.group(' on tab updated', { tab_id, change_info, tab })\n\tFlux.ensure_tab('onUpdated event', tab_id, tab)\n\tif (tab.url)\n\t\tFlux.update_tab_origin(tab_id, tab.url)\n\tif (change_info.status === 'loading')\n\t\tFlux.on_tab_loading(tab_id)\n\tconsole.groupEnd()\n})\n\nbrowser.tabs.onActivated.addListener(({tabId, windowId}) => {\n\tconsole.group(' on tab activated', { tabId, windowId })\n\tFlux.on_tab_activated(tabId)\n\tconsole.groupEnd()\n})\n\n////////////////////////////////////\n// listen to simple messages from other parts of this extension\n// https://developer.browser.com/extensions/messaging#simple\n\nbrowser.runtime.onMessage.addListener((request, sender): Promise<any> | void => {\n\t// FF refreshes content script before the background script starts to receive events\n\treturn once_extension_init_done(() => {\n\t\tconsole.group(` bg received a simple message`)\n\t\tlet response: any = null\n\n\t\ttry {\n\t\t\tconsole.log(\n\t\t\t\tsender.tab\n\t\t\t\t\t? 'from a content script: ' + sender.tab.url\n\t\t\t\t\t: 'from an extension part',\n\t\t\t\t{ sender }\n\t\t\t)\n\n\t\t\tassert(request[MSG_ENTRY], 'MSG_ENTRY')\n\t\t\tconst payload = request[MSG_ENTRY]\n\t\t\tconst { type } = payload\n\n\t\t\tconsole.log({type, payload})\n\n\t\t\tswitch (type) {\n\t\t\t\t/////// from content script ///////\n\t\t\t\tcase MSG_TYPE__REPORT_IS_LIB_INJECTED: {\n\t\t\t\t\tassert(sender.tab, `${type}: is from a tab`)\n\t\t\t\t\tassert(sender.tab!.id, `${type}: is from a tab (2)`)\n\t\t\t\t\tconst tab_id = sender.tab!.id!\n\t\t\t\t\tconst { is_injected, url } = payload\n\t\t\t\t\tFlux.ensure_tab(`${type}`, tab_id, sender.tab)\n\t\t\t\t\tFlux.update_tab_origin(tab_id, url)\n\t\t\t\t\tFlux.report_lib_injection(tab_id, is_injected)\n\t\t\t\t\tbreak\n\t\t\t\t}\n\n\t\t\t\tcase MSG_TYPE__REPORT_DEBUG_API_USAGE: {\n\t\t\t\t\tassert(sender.tab, `${type}: is from a tab`)\n\t\t\t\t\tassert(sender.tab!.id, `${type}: is from a tab (2)`)\n\t\t\t\t\tconst tab_id = sender.tab!.id!\n\t\t\t\t\tFlux.ensure_tab(`${type}`, tab_id, sender.tab)\n\t\t\t\t\tFlux.report_debug_api_usage(tab_id, payload.reports)\n\t\t\t\t\tbreak\n\t\t\t\t}\n\n\t\t\t\t/////// from UI = popup ///////\n\t\t\t\t// no tab infos available from popup\n\t\t\t\tcase MSG_TYPE__REQUEST_CURRENT_PAGE_RELOAD: {\n\t\t\t\t\tconst tab_id = Flux.get_active_tab_id(`from ${type}`)\n\t\t\t\t\tbrowser.tabs.reload(tab_id)\n\t\t\t\t\tbreak\n\t\t\t\t}\n\n\t\t\t\tcase MSG_TYPE__TOGGLE_LIB_INJECTION: {\n\t\t\t\t\tconst tab_id = Flux.get_active_tab_id(`from ${type}`)\n\t\t\t\t\tFlux.toggle_lib_injection(tab_id)\n\t\t\t\t\tbreak\n\t\t\t\t}\n\n\t\t\t\tcase MSG_TYPE__OVERRIDE_SPEC_CHANGED: {\n\t\t\t\t\tconst tab_id = Flux.get_active_tab_id(`from ${type}`)\n\t\t\t\t\tconst { key, partial } = payload\n\t\t\t\t\t Flux.change_override_spec(tab_id, key, partial)\n\t\t\t\t\t break\n\t\t\t\t}\n\n\t\t\t\t/////////////////////\n\t\t\t\tdefault:\n\t\t\t\t\tconsole.error(`Unhandled msg type \"${type}\"!`)\n\t\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\t\tcatch (err) {\n\t\t\tconsole.error(err)\n\t\t}\n\n\t\tconsole.groupEnd()\n\n\t\tif (response)\n\t\t\treturn Promise.resolve(response)\n\n\t\treturn null\n\t})\n})\n\n////////////////////////////////////\n\n// listen to \"port\" messages from other parts of the extension\nbrowser.runtime.onConnect.addListener(port => {\n\tconst { name } = port\n\tconsole.log(` received connection \"${name}\"`, {port})\n\n\tFlux.update_port(name, port)\n\n\tswitch (name) {\n\t\tcase 'devtools':\n\t\tcase 'popup':\n\t\t\tbreak\n\t\tdefault:\n\t\t\tconsole.error(`Unrecognized port name: \"${name}\"!`)\n\t\t\tbreak\n\t}\n})\n\n////////////////////////////////////\n"]}